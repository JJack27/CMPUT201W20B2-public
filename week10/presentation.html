<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-03-19 Thu 11:31 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CMPUT201W20B2 Week 10</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Abram Hindle" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">CMPUT201W20B2 Week 10</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgb8d06da">1. Week10</a>
<ul>
<li><a href="#org8d3738f">1.1. Copyright Statement</a>
<ul>
<li><a href="#org2f6904f">1.1.1. License</a></li>
<li><a href="#org75cc9cb">1.1.2. Hazel Code is licensed under AGPL3.0+</a></li>
</ul>
</li>
<li><a href="#org64e8bd6">1.2. Alternative version</a></li>
<li><a href="#orga5e6dc4">1.3. Init ORG-MODE</a>
<ul>
<li><a href="#org69e4518">1.3.1. Org export</a></li>
<li><a href="#org6c5e415">1.3.2. Org Template</a></li>
</ul>
</li>
<li><a href="#orgb0ddc7f">1.4. Remember how to compile?</a></li>
<li><a href="#org0ea7fdc">1.5. Preprocessor stuff like if-def</a>
<ul>
<li><a href="#org4e410a2">1.5.1. Multiple Files?</a></li>
<li><a href="#orgbf54d78">1.5.2. Example</a></li>
<li><a href="#org83a068e">1.5.3. Linking to libraries</a></li>
<li><a href="#orgca3b1c1">1.5.4. Example Datastructure</a></li>
<li><a href="#orge2b7608">1.5.5. What is the preprocessor doing?</a></li>
<li><a href="#org50dee24">1.5.6. Parameterized Macros</a></li>
</ul>
</li>
<li><a href="#orgee34168">1.6. Makefiles</a>
<ul>
<li><a href="#org66d2aed">1.6.1. Basic Makefile</a></li>
<li><a href="#org8fd023c">1.6.2. DRY Makefile</a></li>
<li><a href="#org99debfe">1.6.3. Idiomatic GCC Makefile</a></li>
<li><a href="#orga64b233">1.6.4. Special Macro Vars</a></li>
<li><a href="#org26df4eb">1.6.5. Can we lint and valgrind with our makefiles?</a></li>
<li><a href="#org78b4acb">1.6.6. .PHONY</a></li>
<li><a href="#org5e91534">1.6.7. Makefile help</a></li>
<li><a href="#org622f2ba">1.6.8. Useful Tool! asan and usan</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgb8d06da" class="outline-2">
<h2 id="orgb8d06da"><span class="section-number-2">1</span> Week10</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org8d3738f" class="outline-3">
<h3 id="org8d3738f"><span class="section-number-3">1.1</span> Copyright Statement</h3>
<div class="outline-text-3" id="text-1-1">
<p>
If you are in CMPUT201 at UAlberta this code is released in the public
domain to you.
</p>

<p>
Otherwise it is (c) 2020 Abram Hindle, Hazel Campbell AGPL3.0+
</p>
</div>

<div id="outline-container-org2f6904f" class="outline-4">
<h4 id="org2f6904f"><span class="section-number-4">1.1.1</span> License</h4>
<div class="outline-text-4" id="text-1-1-1">
<p>
CMPUT 201 C Notes
Copyright (C) 2020 Abram Hindle, Hazel Campbell
</p>

<p>
This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.
</p>

<p>
This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.
</p>

<p>
You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <a href="https://www.gnu.org/licenses/">https://www.gnu.org/licenses/</a>.
</p>
</div>
</div>


<div id="outline-container-org75cc9cb" class="outline-4">
<h4 id="org75cc9cb"><span class="section-number-4">1.1.2</span> Hazel Code is licensed under AGPL3.0+</h4>
<div class="outline-text-4" id="text-1-1-2">
<p>
Hazel's code is also found here
<a href="https://github.com/hazelybell/examples/tree/C-2020-01">https://github.com/hazelybell/examples/tree/C-2020-01</a>
</p>

<p>
Hazel code is licensed: The example code is licensed under the AGPL3+
license, unless otherwise noted.
</p>
</div>
</div>
</div>

<div id="outline-container-org64e8bd6" class="outline-3">
<h3 id="org64e8bd6"><span class="section-number-3">1.2</span> Alternative version</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Checkout the .txt, the .pdf, and the .html version
</p>
</div>
</div>

<div id="outline-container-orga5e6dc4" class="outline-3">
<h3 id="orga5e6dc4"><span class="section-number-3">1.3</span> Init ORG-MODE</h3>
<div class="outline-text-3" id="text-1-3">
<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">I need this for org-mode to work well</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">If we have a new org-mode use ob-shell</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">otherwise use ob-sh --- but not both!</span>
(<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">ob-shell</span> nil 'noerror)
  (<span style="color: #a020f0;">progn</span>
    (org-babel-do-load-languages 'org-babel-load-languages '((shell . t))))
  (<span style="color: #a020f0;">progn</span>
    (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">ob-sh</span>)
    (org-babel-do-load-languages 'org-babel-load-languages '((sh . t)))))
(org-babel-do-load-languages 'org-babel-load-languages '((C . t)))
(org-babel-do-load-languages 'org-babel-load-languages '((python . t)))
(<span style="color: #a020f0;">setq</span> org-src-fontify-natively t)
(<span style="color: #a020f0;">setq</span> org-confirm-babel-evaluate nil) <span style="color: #b22222;">;; </span><span style="color: #b22222;">danger!</span>
(custom-set-faces
 '(org-block ((t (<span style="color: #483d8b;">:inherit</span> shadow <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"black"</span>))))
 '(org-code ((t (<span style="color: #483d8b;">:inherit</span> shadow <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"black"</span>)))))
</pre>
</div>
</div>

<div id="outline-container-org69e4518" class="outline-4">
<h4 id="org69e4518"><span class="section-number-4">1.3.1</span> Org export</h4>
<div class="outline-text-4" id="text-1-3-1">
<div class="org-src-container">
<pre class="src src-elisp">(org-html-export-to-html)
(org-latex-export-to-pdf)
(org-ascii-export-to-ascii)
</pre>
</div>
</div>
</div>


<div id="outline-container-org6c5e415" class="outline-4">
<h4 id="org6c5e415"><span class="section-number-4">1.3.2</span> Org Template</h4>
<div class="outline-text-4" id="text-1-3-2">
<p>
Copy and paste this to demo C
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;stdio.h&gt;</span>

<span style="color: #228b22;">int</span> <span style="color: #0000ff;">main</span>(<span style="color: #228b22;">int</span> <span style="color: #a0522d;">argc</span>, <span style="color: #228b22;">char</span>**<span style="color: #a0522d;">argv</span>) {
    <span style="color: #a020f0;">return</span> 0;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb0ddc7f" class="outline-3">
<h3 id="orgb0ddc7f"><span class="section-number-3">1.4</span> Remember how to compile?</h3>
<div class="outline-text-3" id="text-1-4">
<p>
gcc  -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -o programname programname.c
</p>
</div>
</div>

<div id="outline-container-org0ea7fdc" class="outline-3">
<h3 id="org0ea7fdc"><span class="section-number-3">1.5</span> Preprocessor stuff like if-def</h3>
<div class="outline-text-3" id="text-1-5">
<p>
The preprocessor deals with all the lines that you start with an
octalthrope or hash mark: #
</p>

<p>
The preprocessor lets you define symbols, macros, and include
files.
</p>
</div>

<div id="outline-container-org4e410a2" class="outline-4">
<h4 id="org4e410a2"><span class="section-number-4">1.5.1</span> Multiple Files?</h4>
<div class="outline-text-4" id="text-1-5-1">
<p>
How does stdio.h work?
</p>

<p>
<a href="file:///usr/include/stdio.h">file:///usr/include/stdio.h</a>
</p>

<p>
It defines definitions, macros, and prototypes for the stdio library.
The linker will link your executable to that library that was already
compiled.
</p>

<p>
.h files help us organize C programs by including definitions for the
object files and libraries that we will create.
</p>

<p>
Libc or glibc contains the implemention of those definitions.
libc.so.6 =&gt; /lib/x86<sub>64</sub>-linux-gnu/libc.so.6 (0x00007f919f994000)
</p>

<p>
libc is composed of many .c files compiled into .o object files and
then combined into a library. A library is like an executable that
other executables rely on for code. malloc is defined in malloc.c and
has a malloc.h file!
</p>

<p>
Typically if I make a library I will make a .h file so the definitions
can be shared with other .c files. But the implementation of the functions
will go into a .c file that includes that .h as well.
</p>

<ul class="org-ul">
<li>main.c
<ul class="org-ul">
<li>#include &lt;stdio.h&gt;</li>
<li>#include "library.h"</li>
<li>relies on library.o</li>
</ul></li>
<li>library.c
<ul class="org-ul">
<li>#include "library.h"</li>
<li>makes library.o</li>
</ul></li>
<li>library.h
<ul class="org-ul">
<li>defines functions and definitions from library.c</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-orgbf54d78" class="outline-4">
<h4 id="orgbf54d78"><span class="section-number-4">1.5.2</span> Example</h4>
<div class="outline-text-4" id="text-1-5-2">
<p>
This is a useful function to check if scanf read 1 or more elements
and didn't read EOF.
</p>

<p>
<a href="./checkinput.c">./checkinput.c</a>
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">"checkinput.h"</span>
<span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;stdio.h&gt;</span>
<span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;stdlib.h&gt;</span>
<span style="color: #b22222;">/* </span><span style="color: #b22222;">checkInput: given the result of scanf check if it </span>
<span style="color: #b22222;"> * 0 elements read or EOF. If so exit(1) with a warning.</span>
<span style="color: #b22222;"> *</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*/</span>
<span style="color: #228b22;">void</span> <span style="color: #0000ff;">checkInput</span>(<span style="color: #228b22;">int</span> <span style="color: #a0522d;">err</span>) {
  <span style="color: #a020f0;">if</span> (!err || err == EOF) {
    printf(<span style="color: #8b2252;">"\nInvalid input!\n"</span>);
    exit(1);
  }
}
</pre>
</div>

<p>
<a href="./checkinput.h">./checkinput.h</a>
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #b22222;">// </span><span style="color: #b22222;">Have a guard to ensure that we don't include it multiple times.</span>
<span style="color: #483d8b;">#if</span><span style="color: #483d8b;">n</span><span style="color: #483d8b;">def</span> _CHECKINPUT_H_
<span style="color: #b22222;">/* </span><span style="color: #b22222;">checkInput: given the result of scanf check if it </span>
<span style="color: #b22222;"> * 0 elements read or EOF. If so exit(1) with a warning.</span>
<span style="color: #b22222;"> *</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*/</span>
<span style="color: #483d8b;">#define</span> <span style="color: #a0522d;">_CHECKINPUT_H_</span>
<span style="color: #228b22;">void</span> <span style="color: #0000ff;">checkInput</span>(<span style="color: #228b22;">int</span> <span style="color: #a0522d;">err</span>); <span style="color: #b22222;">// </span><span style="color: #b22222;">a prototype!</span>
<span style="color: #483d8b;">#endif</span>
</pre>
</div>

<p>
<a href="./checkinput-driver.c">./checkinput-driver.c</a>
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">"checkinput.h"</span>
<span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;stdio.h&gt;</span>
<span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">"checkinput.h"</span>
<span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">"checkinput.h"</span>
<span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">"checkinput.h"</span>
<span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">"checkinput.h"</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">void checkInput(int err); // a prototype!</span>


<span style="color: #228b22;">int</span> <span style="color: #0000ff;">main</span>() {
  <span style="color: #228b22;">int</span> <span style="color: #a0522d;">input</span>;
  checkInput(scanf(<span style="color: #8b2252;">"%d"</span>, &amp;input));  
  puts(<span style="color: #8b2252;">"Good Input!"</span>);
}
</pre>
</div>
</div>

<ol class="org-ol">
<li><a id="orgf832b7d"></a>Compiling Multiple Files Easy Mode<br />
<div class="outline-text-5" id="text-1-5-2-1">
<p>
We can put all our .c files on the same line and compile them all at
once! This is handy. But quite limiting.
</p>

<p>
We can't parallel compile. We can't use all our cores. We can't
interupt compilation.
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">build checkinput-driver</span>
gcc  -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 <span style="color: #8b2252;">\</span>
       -o checkinput-driver checkinput-driver.c &amp;&amp; <span style="color: #8b2252;">\</span>
( <span style="color: #483d8b;">echo</span> YES | ./checkinput-driver  || <span style="color: #8b2252;">\</span>
  <span style="color: #483d8b;">echo</span> 100 | ./checkinput-driver )
</pre>
</div>

<p>
BOTH FILES
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">build checkinput-driver</span>
gcc  -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 <span style="color: #8b2252;">\</span>
       -o checkinput-driver checkinput-driver.c <span style="color: #8b2252;">\</span>
       checkinput.c &amp;&amp; <span style="color: #8b2252;">\</span>
( <span style="color: #483d8b;">echo</span> YES | ./checkinput-driver  || <span style="color: #8b2252;">\</span>
  <span style="color: #483d8b;">echo</span> 100 | ./checkinput-driver )
</pre>
</div>

<pre class="example">

Invalid input!
Good Input!
</pre>
</div>
</li>


<li><a id="orgd68f2be"></a>Compiling Multiple Files with Linking<br />
<div class="outline-text-5" id="text-1-5-2-2">
<p>
OK now we compile it. The main is the last to compile and it needs all
the .o files.
</p>

<p>
All the .c files that don't contain main need to be compiled to object
files. Use the -c flags to do this.
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">build checkinput.o</span>
gcc  -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 <span style="color: #8b2252;">\</span>
       -c checkinput.c
file checkinput.o
<span style="color: #b22222;"># </span><span style="color: #b22222;">build checkinput-driver and link it to checkinput.o</span>
gcc  -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 <span style="color: #8b2252;">\</span>
       -c checkinput-driver.c
file checkinput-driver.o
gcc  -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 <span style="color: #8b2252;">\</span>
       -o checkinput-driver checkinput-driver.o <span style="color: #8b2252;">\</span>
       checkinput.o
file checkinput-driver
</pre>
</div>

<pre class="example">
checkinput.o: ELF 64-bit LSB relocatable, x86-64, version 1 (SYSV), with debug_info, not stripped
checkinput-driver.o: ELF 64-bit LSB relocatable, x86-64, version 1 (SYSV), with debug_info, not stripped
checkinput-driver: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/l, for GNU/Linux 3.2.0, BuildID[sha1]=a0d9427bff4f04c1475aa889bce881e4a5b7fb31, with debug_info, not stripped
</pre>


<ul class="org-ul">
<li>If you want some translation :-)
<ul class="org-ul">
<li>ELF - Executable and Linking format</li>
<li>relocatable - you can link it</li>
<li>shared object - relocatable and executable</li>
<li>LSB - little endian/least significant bit</li>
<li>x86-64 - 64 bit x86 processor</li>
<li>version 1 (SYSV) - version 1 of ELF System V Unix spec.</li>
</ul></li>
</ul>

<p>
Test drive it
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">echo</span>    | ./checkinput-driver <span style="color: #b22222;"># </span><span style="color: #b22222;">bad</span>
<span style="color: #483d8b;">echo</span> X  | ./checkinput-driver <span style="color: #b22222;"># </span><span style="color: #b22222;">bad</span>
<span style="color: #483d8b;">echo</span> 1  | ./checkinput-driver <span style="color: #b22222;"># </span><span style="color: #b22222;">good</span>
<span style="color: #483d8b;">echo</span> -1 | ./checkinput-driver <span style="color: #b22222;"># </span><span style="color: #b22222;">good</span>
</pre>
</div>

<pre class="example">

Invalid input!

Invalid input!
Good Input!
Good Input!
</pre>


<p>
Now let's see how it is linked!
</p>

<div class="org-src-container">
<pre class="src src-sh">ls -l ./checkinput-driver
ls -l /lib/x86_64-linux-gnu/libc-2.27.so
ldd ./checkinput-driver
</pre>
</div>

<pre class="example">
-rwxrwxr-x 1 hindle1 hindle1 38472 Mar 19 11:31 ./checkinput-driver
-rwxr-xr-x 1 root root 2030544 Apr 16  2018 /lib/x86_64-linux-gnu/libc-2.27.so
	linux-vdso.so.1 (0x00007ffe69d2b000)
	libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f07380e1000)
	/lib64/ld-linux-x86-64.so.2 (0x00007f07386d4000)
</pre>


<ul class="org-ul">
<li>syscalls (read, write, gettimeofday) and libc (libc is stuff like stdio.h)</li>
</ul>
</div>
</li>
</ol>
</div>

<div id="outline-container-org83a068e" class="outline-4">
<h4 id="org83a068e"><span class="section-number-4">1.5.3</span> Linking to libraries</h4>
<div class="outline-text-4" id="text-1-5-3">
<p>
`math.h` includes fun functions like cos and tanh.
</p>

<p>
Math.h, part of the C stdlib, is distributed as a seperate library.
Not all computers have floating point numbers so why bother compiling
floating code for them?
</p>

<p>
<a href="file:///usr/include/math.h">file:///usr/include/math.h</a>
</p>

<p>
I add the flag -lm so we get our math library :-)
</p>
<div class="org-src-container">
<pre class="src src-C"><span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;stdio.h&gt;</span>
<span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;math.h&gt;</span>

<span style="color: #228b22;">int</span> <span style="color: #0000ff;">main</span>() {
    <span style="color: #228b22;">double</span> <span style="color: #a0522d;">x</span> = 0.0;
    <span style="color: #228b22;">double</span> <span style="color: #a0522d;">th</span> = tanh(x);
    <span style="color: #228b22;">double</span> <span style="color: #a0522d;">lh</span> = th;
    <span style="color: #a020f0;">do</span> {
        lh = th;
        x += 0.5;
        th = tanh(x);
        printf(<span style="color: #8b2252;">"tanh(%e) == %e\n"</span>, x, th);
    } <span style="color: #a020f0;">while</span>( lh != th );
}
</pre>
</div>

<pre class="example">
tanh(5.000000e-01) == 4.621172e-01
tanh(1.000000e+00) == 7.615942e-01
tanh(1.500000e+00) == 9.051483e-01
tanh(2.000000e+00) == 9.640276e-01
tanh(2.500000e+00) == 9.866143e-01
tanh(3.000000e+00) == 9.950548e-01
tanh(3.500000e+00) == 9.981779e-01
tanh(4.000000e+00) == 9.993293e-01
tanh(4.500000e+00) == 9.997532e-01
tanh(5.000000e+00) == 9.999092e-01
tanh(5.500000e+00) == 9.999666e-01
tanh(6.000000e+00) == 9.999877e-01
tanh(6.500000e+00) == 9.999955e-01
tanh(7.000000e+00) == 9.999983e-01
tanh(7.500000e+00) == 9.999994e-01
tanh(8.000000e+00) == 9.999998e-01
tanh(8.500000e+00) == 9.999999e-01
tanh(9.000000e+00) == 1.000000e+00
tanh(9.500000e+00) == 1.000000e+00
tanh(1.000000e+01) == 1.000000e+00
tanh(1.050000e+01) == 1.000000e+00
tanh(1.100000e+01) == 1.000000e+00
tanh(1.150000e+01) == 1.000000e+00
tanh(1.200000e+01) == 1.000000e+00
tanh(1.250000e+01) == 1.000000e+00
tanh(1.300000e+01) == 1.000000e+00
tanh(1.350000e+01) == 1.000000e+00
tanh(1.400000e+01) == 1.000000e+00
tanh(1.450000e+01) == 1.000000e+00
tanh(1.500000e+01) == 1.000000e+00
tanh(1.550000e+01) == 1.000000e+00
tanh(1.600000e+01) == 1.000000e+00
tanh(1.650000e+01) == 1.000000e+00
tanh(1.700000e+01) == 1.000000e+00
tanh(1.750000e+01) == 1.000000e+00
tanh(1.800000e+01) == 1.000000e+00
tanh(1.850000e+01) == 1.000000e+00
tanh(1.900000e+01) == 1.000000e+00
tanh(1.950000e+01) == 1.000000e+00
tanh(2.000000e+01) == 1.000000e+00
</pre>









<p>
OK so how does this work, how do link to math?
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">build checkinput-driver and link it to checkinput.o</span>
gcc  -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 <span style="color: #8b2252;">\</span>
       -o poor-tanh-example poor-tanh-example.c <span style="color: #8b2252;">\</span>
       -lm
file poor-tanh-example
./poor-tanh-example | wc
ldd ./poor-tanh-example
</pre>
</div>

<pre class="example">
poor-tanh-example: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/l, for GNU/Linux 3.2.0, BuildID[sha1]=fdd28691d4637c2a9b9a76b129ea7585894e4378, with debug_info, not stripped
     40     120    1400
	linux-vdso.so.1 (0x00007fffee9f7000)
	libm.so.6 =&gt; /lib/x86_64-linux-gnu/libm.so.6 (0x00007fef60130000)
	libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007fef5fd3f000)
	/lib64/ld-linux-x86-64.so.2 (0x00007fef606d0000)
</pre>


<p>
See that? libm.so.6 is in there.
</p>

<p>
Larger programs link to lots of libraries.
</p>

<div class="org-src-container">
<pre class="src src-sh">ldd <span style="color: #ff00ff;">`which xterm`</span>
</pre>
</div>

<pre class="example">
linux-vdso.so.1 (0x00007ffe7eede000)
libXft.so.2 =&gt; /usr/lib/x86_64-linux-gnu/libXft.so.2 (0x00007fdfa84ae000)
libfontconfig.so.1 =&gt; /usr/lib/x86_64-linux-gnu/libfontconfig.so.1 (0x00007fdfa8269000)
libXaw.so.7 =&gt; /usr/lib/x86_64-linux-gnu/libXaw.so.7 (0x00007fdfa7ff5000)
libXmu.so.6 =&gt; /usr/lib/x86_64-linux-gnu/libXmu.so.6 (0x00007fdfa7ddc000)
libXt.so.6 =&gt; /usr/lib/x86_64-linux-gnu/libXt.so.6 (0x00007fdfa7b73000)
libX11.so.6 =&gt; /usr/lib/x86_64-linux-gnu/libX11.so.6 (0x00007fdfa783b000)
libXinerama.so.1 =&gt; /usr/lib/x86_64-linux-gnu/libXinerama.so.1 (0x00007fdfa7638000)
libXpm.so.4 =&gt; /usr/lib/x86_64-linux-gnu/libXpm.so.4 (0x00007fdfa7426000)
libICE.so.6 =&gt; /usr/lib/x86_64-linux-gnu/libICE.so.6 (0x00007fdfa720b000)
libutempter.so.0 =&gt; /usr/lib/x86_64-linux-gnu/libutempter.so.0 (0x00007fdfa7008000)
libtinfo.so.5 =&gt; /lib/x86_64-linux-gnu/libtinfo.so.5 (0x00007fdfa6dde000)
libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007fdfa69ed000)
libfreetype.so.6 =&gt; /usr/lib/x86_64-linux-gnu/libfreetype.so.6 (0x00007fdfa6739000)
libXrender.so.1 =&gt; /usr/lib/x86_64-linux-gnu/libXrender.so.1 (0x00007fdfa652f000)
libexpat.so.1 =&gt; /lib/x86_64-linux-gnu/libexpat.so.1 (0x00007fdfa62fd000)
libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007fdfa60de000)
libXext.so.6 =&gt; /usr/lib/x86_64-linux-gnu/libXext.so.6 (0x00007fdfa5ecc000)
libSM.so.6 =&gt; /usr/lib/x86_64-linux-gnu/libSM.so.6 (0x00007fdfa5cc4000)
libxcb.so.1 =&gt; /usr/lib/x86_64-linux-gnu/libxcb.so.1 (0x00007fdfa5a9c000)
libdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x00007fdfa5898000)
libbsd.so.0 =&gt; /lib/x86_64-linux-gnu/libbsd.so.0 (0x00007fdfa5683000)
/lib64/ld-linux-x86-64.so.2 (0x00007fdfa8973000)
libpng16.so.16 =&gt; /usr/lib/x86_64-linux-gnu/libpng16.so.16 (0x00007fdfa5451000)
libz.so.1 =&gt; /lib/x86_64-linux-gnu/libz.so.1 (0x00007fdfa5234000)
libuuid.so.1 =&gt; /lib/x86_64-linux-gnu/libuuid.so.1 (0x00007fdfa502d000)
libXau.so.6 =&gt; /usr/lib/x86_64-linux-gnu/libXau.so.6 (0x00007fdfa4e29000)
libXdmcp.so.6 =&gt; /usr/lib/x86_64-linux-gnu/libXdmcp.so.6 (0x00007fdfa4c23000)
librt.so.1 =&gt; /lib/x86_64-linux-gnu/librt.so.1 (0x00007fdfa4a1b000)
libm.so.6 =&gt; /lib/x86_64-linux-gnu/libm.so.6 (0x00007fdfa467d000)
</pre>

<p>
See! Lots of libraries!
</p>
</div>

<ol class="org-ol">
<li><a id="org629b824"></a>Summary<br />
<div class="outline-text-5" id="text-1-5-3-1">
<p>
To link to a shared library with gcc or clang use the:
  -l flag
  -llibraryyouwant
</p>

<p>
For libm use -lm for librt use -lrt
</p>

<p>
If your library is not in the current lib path you will need to
specify a library path use -L/path/to/library
</p>

<p>
OK let's see how it affects you.
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgca3b1c1" class="outline-4">
<h4 id="orgca3b1c1"><span class="section-number-4">1.5.4</span> Example Datastructure</h4>
<div class="outline-text-4" id="text-1-5-4">
<p>
Let's make a brief data structure about one of my favourite topics:
cool bears.
</p>

<p>
<a href="./coolbears.c">./coolbears.c</a>
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #483d8b;">#define</span> <span style="color: #a0522d;">_POSIX_C_SOURCE</span> 200809L <span style="color: #b22222;">// </span><span style="color: #b22222;">&lt;-- needed for strdup</span>
<span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">"coolbears.h"</span>
<span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;stdio.h&gt;</span>
<span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;stdlib.h&gt;</span>
<span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;string.h&gt;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">hiding struct details from other programmers</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">I DONT TRUST THEM. Especially Hazel ;-) (don't tell hazel)</span>
<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">coolbear_t</span> {
    <span style="color: #228b22;">char</span> * <span style="color: #a0522d;">name</span>;
    <span style="color: #228b22;">float</span> <span style="color: #a0522d;">temperature</span>;
};

<span style="color: #228b22;">CoolBear</span> <span style="color: #0000ff;">createCoolBear</span>(<span style="color: #228b22;">char</span> * <span style="color: #a0522d;">name</span>, <span style="color: #228b22;">float</span> <span style="color: #a0522d;">temperature</span>) {
    <span style="color: #228b22;">CoolBear</span> <span style="color: #a0522d;">coolbear</span> = malloc(<span style="color: #a020f0;">sizeof</span>(*coolbear));
    coolbear-&gt;name = strdup(name);
    coolbear-&gt;temperature = temperature;
    <span style="color: #a020f0;">return</span> coolbear;
}
<span style="color: #228b22;">void</span> <span style="color: #0000ff;">freeCoolBear</span>(<span style="color: #228b22;">CoolBear</span> <span style="color: #a0522d;">coolBear</span>) {
    <span style="color: #a020f0;">if</span> (coolBear == <span style="color: #008b8b;">NULL</span>) {
        abort();
    }
    <span style="color: #a020f0;">if</span> (coolBear-&gt;name != <span style="color: #008b8b;">NULL</span>) {
        free(coolBear-&gt;name);
    }
    free(coolBear);
}
<span style="color: #228b22;">char</span> * <span style="color: #0000ff;">getNameCoolBear</span>(<span style="color: #228b22;">CoolBear</span> <span style="color: #a0522d;">coolbear</span>) {
    <span style="color: #a020f0;">return</span> coolbear-&gt;name;
}
<span style="color: #228b22;">float</span>    <span style="color: #0000ff;">getTemperatureCoolBear</span>(<span style="color: #228b22;">CoolBear</span> <span style="color: #a0522d;">coolbear</span>) {
   <span style="color: #a020f0;">return</span> coolbear-&gt;temperature;
}
<span style="color: #b22222;">// </span><span style="color: #b22222;">NO MAIN!</span>
</pre>
</div>



<p>
<a href="./coolbears.h">./coolbears.h</a>
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #b22222;">// </span><span style="color: #b22222;">Have a guard to ensure that we don't include it multiple times.</span>
<span style="color: #483d8b;">#if</span><span style="color: #483d8b;">n</span><span style="color: #483d8b;">def</span> _COOLBEARS_H_
<span style="color: #b22222;">/* </span><span style="color: #b22222;">checkInput: given the result of scanf check if it </span>
<span style="color: #b22222;"> * 0 elements read or EOF. If so exit(1) with a warning.</span>
<span style="color: #b22222;"> *</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*/</span>
<span style="color: #483d8b;">#define</span> <span style="color: #a0522d;">_COOLBEARS_H_</span>
<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">coolbear_t</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">Forward declaration -- I am not sharing details!</span>
<span style="color: #a020f0;">typedef</span> <span style="color: #a020f0;">struct</span> <span style="color: #228b22;">coolbear_t</span> * <span style="color: #228b22;">CoolBear</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">Struct point as type</span>

<span style="color: #228b22;">CoolBear</span> <span style="color: #0000ff;">createCoolBear</span>(<span style="color: #228b22;">char</span> * <span style="color: #a0522d;">name</span>, <span style="color: #228b22;">float</span> <span style="color: #a0522d;">temperature</span>); <span style="color: #b22222;">// </span><span style="color: #b22222;">a prototype!</span>
<span style="color: #228b22;">void</span>     <span style="color: #0000ff;">freeCoolBear</span>(<span style="color: #228b22;">CoolBear</span> <span style="color: #a0522d;">coolBear</span>); <span style="color: #b22222;">// </span><span style="color: #b22222;">a prototype!</span>
<span style="color: #228b22;">char</span> *   <span style="color: #0000ff;">getNameCoolBear</span>(<span style="color: #228b22;">CoolBear</span> <span style="color: #a0522d;">coolbear</span>); <span style="color: #b22222;">// </span><span style="color: #b22222;">a prototype!</span>
<span style="color: #228b22;">float</span>    <span style="color: #0000ff;">getTemperatureCoolBear</span>(<span style="color: #228b22;">CoolBear</span> <span style="color: #a0522d;">coolbear</span>); <span style="color: #b22222;">// </span><span style="color: #b22222;">a prototype!</span>

<span style="color: #483d8b;">#endif</span>
</pre>
</div>

<p>
<a href="./coolbears-driver.c">./coolbears-driver.c</a>
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">"coolbears.h"</span>
<span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;stdio.h&gt;</span>

<span style="color: #228b22;">int</span> <span style="color: #0000ff;">main</span>() {
  <span style="color: #228b22;">CoolBear</span> <span style="color: #a0522d;">ziggy</span> = createCoolBear(<span style="color: #8b2252;">"Ziggy"</span>,-23.0 <span style="color: #b22222;">/* </span><span style="color: #b22222;">C </span><span style="color: #b22222;">*/</span>);
  <span style="color: #228b22;">CoolBear</span> <span style="color: #a0522d;">kevin</span> = createCoolBear(<span style="color: #8b2252;">"Kevin"</span>,-32.0 <span style="color: #b22222;">/* </span><span style="color: #b22222;">C </span><span style="color: #b22222;">*/</span>);
  <span style="color: #228b22;">CoolBear</span> <span style="color: #a0522d;">coolest</span> = (getTemperatureCoolBear(ziggy) &lt; 
                      getTemperatureCoolBear(kevin))? ziggy : kevin;
  printf(<span style="color: #8b2252;">"The coolest bear is %s\n"</span>, getNameCoolBear( coolest ));
  <span style="color: #b22222;">// </span><span style="color: #b22222;">// we actually don't know about name so we can't reference it below</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">printf("The coolest bear is %s\n", coolest-&gt;name );</span>
  freeCoolBear(ziggy);
  freeCoolBear(kevin);
}
</pre>
</div>

<p>
Compile it. -c the coolbears.c to make coolbears.o and then 
compile coolbears-driver.c
</p>

<p>
coolbears-driver.c has no clue how to access 
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">build coolbears.o</span>
gcc  -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 <span style="color: #8b2252;">\</span>
       -c coolbears.c
<span style="color: #b22222;"># </span><span style="color: #b22222;">build coolbears-driver and link it to coolbears.o</span>
gcc  -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 <span style="color: #8b2252;">\</span>
       -o coolbears-driver coolbears-driver.c <span style="color: #8b2252;">\</span>
       coolbears.o 
./coolbears-driver
</pre>
</div>

<pre class="example">
The coolest bear is Kevin
</pre>


<p>
If we access coolest-&gt;name we get:
</p>

<pre class="example">
coolbears-driver.c: In function ‘main’:
coolbears-driver.c:11:62: error: dereferencing pointer to incomplete type ‘struct coolbear_t’
   printf("The coolest bear is %s\n", getNameCoolBear( coolest-&gt;name ));
</pre>
</div>
</div>


<div id="outline-container-orge2b7608" class="outline-4">
<h4 id="orge2b7608"><span class="section-number-4">1.5.5</span> What is the preprocessor doing?</h4>
<div class="outline-text-4" id="text-1-5-5">
<p>
Let's use the -E flag to see what checkinput.c becomes
</p>

<p>
This output contains glibc headers for stdio.h and stdlib.h these
should be under the GPLV3 (c) the Glibc project and GNU project.
</p>

<p>
If you want more preprocessor options checkout:
</p>

<p>
<a href="https://gcc.gnu.org/onlinedocs/gcc-5.2.0/gcc/Preprocessor-Options.html">https://gcc.gnu.org/onlinedocs/gcc-5.2.0/gcc/Preprocessor-Options.html</a>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">build checkinput.o</span>
gcc -E -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 <span style="color: #8b2252;">\</span>
       checkinput.c &gt; checkinput-preprocessor.c
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">
</pre>
</div>

<p>
It produces this file:
</p>

<p>
<a href="checkinput-preprocessor.c">checkinput-preprocessor.c</a>
</p>


<div class="org-src-container">
<pre class="src src-C"><span style="color: #483d8b;"># 1</span> <span style="color: #8b2252;">"checkinput.c"</span>
<span style="color: #483d8b;"># 1</span> <span style="color: #8b2252;">"/home/hindle1/projects/CMPUT201W20/2020-01/CMPUT201W20B2-public/week10//"</span>
<span style="color: #483d8b;"># 1</span> <span style="color: #8b2252;">"&lt;built-in&gt;"</span>
<span style="color: #483d8b;">#define</span> <span style="color: #a0522d;">__STDC__</span> 1
<span style="color: #483d8b;">#define</span> <span style="color: #a0522d;">__STDC_VERSION__</span> 199901L
<span style="color: #483d8b;">#define</span> <span style="color: #a0522d;">__STDC_HOSTED__</span> 1
<span style="color: #483d8b;">#define</span> <span style="color: #a0522d;">__GNUC__</span> 7
<span style="color: #483d8b;">#define</span> <span style="color: #a0522d;">__GNUC_MINOR__</span> 5
<span style="color: #483d8b;">#define</span> <span style="color: #a0522d;">__GNUC_PATCHLEVEL__</span> 0

<span style="color: #b22222;">// </span><span style="color: #b22222;">lots of definitions</span>

<span style="color: #483d8b;"># 1</span> <span style="color: #8b2252;">"/usr/include/stdio.h"</span> 1 3 4
<span style="color: #483d8b;"># 24</span> <span style="color: #8b2252;">"/usr/include/stdio.h"</span> 3 4
<span style="color: #483d8b;">#define</span> <span style="color: #a0522d;">_STDIO_H</span> 1

<span style="color: #b22222;">// </span><span style="color: #b22222;">Start of STDIO_H</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>

<span style="color: #a020f0;">extern</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">printf</span> (<span style="color: #a020f0;">const</span> <span style="color: #228b22;">char</span> *<span style="color: #a0522d;">__restrict</span> __format, ...);

<span style="color: #a020f0;">extern</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">sprintf</span> (<span style="color: #228b22;">char</span> *<span style="color: #a0522d;">__restrict</span> __s,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">char</span> *<span style="color: #a0522d;">__restrict</span> __format, ...) <span style="color: #a020f0;">__attribute__</span> ((__nothrow__));


<span style="color: #b22222;">// </span><span style="color: #b22222;">LOTS OF STDIO.H</span>


<span style="color: #b22222;">// </span><span style="color: #b22222;">LOTS OF STDLIB.H</span>

<span style="color: #483d8b;"># 1016</span> <span style="color: #8b2252;">"/usr/include/stdlib.h"</span> 3 4
<span style="color: #483d8b;"># 1</span> <span style="color: #8b2252;">"/usr/include/x86_64-linux-gnu/bits/stdlib-float.h"</span> 1 3 4
<span style="color: #483d8b;"># 1017</span> <span style="color: #8b2252;">"/usr/include/stdlib.h"</span> 2 3 4
<span style="color: #483d8b;"># 1026</span> <span style="color: #8b2252;">"/usr/include/stdlib.h"</span> 3 4

<span style="color: #483d8b;"># 5</span> <span style="color: #8b2252;">"checkinput.c"</span> 2





<span style="color: #483d8b;"># 9</span> <span style="color: #8b2252;">"checkinput.c"</span>
<span style="color: #228b22;">void</span> <span style="color: #0000ff;">checkInput</span>(<span style="color: #228b22;">int</span> <span style="color: #a0522d;">err</span>) {
  <span style="color: #a020f0;">if</span> (!err || err == 
<span style="color: #483d8b;"># 10</span> <span style="color: #8b2252;">"checkinput.c"</span> 3 4
                    (-1)
<span style="color: #483d8b;"># 10</span> <span style="color: #8b2252;">"checkinput.c"</span>
                       ) {
    printf(<span style="color: #8b2252;">"\nInvalid input!\n"</span>);
    exit(1);
  }
}
<span style="color: #a020f0;">return</span> 0;
}
</pre>
</div>

<p>
<a href="checkinput-preprocessor.c">checkinput-preprocessor.c</a>
</p>
</div>
</div>


<div id="outline-container-org50dee24" class="outline-4">
<h4 id="org50dee24"><span class="section-number-4">1.5.6</span> Parameterized Macros</h4>
<div class="outline-text-4" id="text-1-5-6">
<p>
As we just demonstrated Macros generate code. So we can make compile
functions that generate code. These functions run at compile time and
generate code that is compiled by C.
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;stdio.h&gt;</span>
<span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;stdlib.h&gt;</span>
<span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;stdbool.h&gt;</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">RELU is a rectified linear unit. These are popular in convolutional neural networks</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">they are 0 for 0 and negative numbers and they are the identity for positive numbers.</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">RELU(-100) = RELU(-1) = 0 &amp;&amp; RELU(1) = 1 &amp;&amp; RELU(100) = 100</span>
<span style="color: #483d8b;">#define</span> <span style="color: #0000ff;">RELU</span>(<span style="color: #a0522d;">x</span>)  (( x &lt; 0 )?0:x)

<span style="color: #228b22;">int</span> <span style="color: #0000ff;">main</span>() {
    <span style="color: #b22222;">// </span><span style="color: #b22222;">ints</span>
    <span style="color: #a020f0;">for</span> (<span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = -10; i &lt; 10; i++) {
        printf(<span style="color: #8b2252;">"RELU(%d)=%d\n"</span>, i, RELU(i));
    }
    puts(<span style="color: #8b2252;">"\n"</span>);
    <span style="color: #b22222;">// </span><span style="color: #b22222;">more in the range of neural networks</span>
    <span style="color: #a020f0;">for</span> (<span style="color: #228b22;">double</span> <span style="color: #a0522d;">i</span> = -1; i &lt; 1; i+=0.1) {
        printf(<span style="color: #8b2252;">"RELU(%f)=%f\n"</span>, i, RELU(i));
    }
    puts(<span style="color: #8b2252;">"\n"</span>);
}
</pre>
</div>

<pre class="example">
RELU(-10)=0
RELU(-9)=0
RELU(-8)=0
RELU(-7)=0
RELU(-6)=0
RELU(-5)=0
RELU(-4)=0
RELU(-3)=0
RELU(-2)=0
RELU(-1)=0
RELU(0)=0
RELU(1)=1
RELU(2)=2
RELU(3)=3
RELU(4)=4
RELU(5)=5
RELU(6)=6
RELU(7)=7
RELU(8)=8
RELU(9)=9


RELU(-1.000000)=0.000000
RELU(-0.900000)=0.000000
RELU(-0.800000)=0.000000
RELU(-0.700000)=0.000000
RELU(-0.600000)=0.000000
RELU(-0.500000)=0.000000
RELU(-0.400000)=0.000000
RELU(-0.300000)=0.000000
RELU(-0.200000)=0.000000
RELU(-0.100000)=0.000000
RELU(-0.000000)=0.000000
RELU(0.100000)=0.100000
RELU(0.200000)=0.200000
RELU(0.300000)=0.300000
RELU(0.400000)=0.400000
RELU(0.500000)=0.500000
RELU(0.600000)=0.600000
RELU(0.700000)=0.700000
RELU(0.800000)=0.800000
RELU(0.900000)=0.900000
RELU(1.000000)=1.000000
</pre>

<div class="org-src-container">
<pre class="src src-sh">gcc -E -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 <span style="color: #8b2252;">\</span>
       relu.c &gt; <span style="color: #8b2252;">\</span>
       relu-expanded.c
</pre>
</div>

<p>
<a href="relu-expanded.c">relu-expanded.c</a>
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #483d8b;">#define</span> <span style="color: #0000ff;">RELU</span>(<span style="color: #a0522d;">x</span>) (( x &lt; 0 )?0:x)


<span style="color: #483d8b;"># 10</span> <span style="color: #8b2252;">"relu.c"</span>
<span style="color: #228b22;">int</span> <span style="color: #0000ff;">main</span>() {

    <span style="color: #a020f0;">for</span> (<span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = -10; i &lt; 10; i++) {
        printf(<span style="color: #8b2252;">"RELU(%d)=%d\n"</span>, i, (( i &lt; 0 )?0:i));
    }
    puts(<span style="color: #8b2252;">"\n"</span>);

    <span style="color: #a020f0;">for</span> (<span style="color: #228b22;">double</span> <span style="color: #a0522d;">i</span> = -1; i &lt; 1; i+=0.1) {
        printf(<span style="color: #8b2252;">"RELU(%f)=%f\n"</span>, i, (( i &lt; 0 )?0:i));
    }
    puts(<span style="color: #8b2252;">"\n"</span>);
}
</pre>
</div>

<p>
That's interesting, but be aware that x is not a value. It is a set of tokens.
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;math.h&gt;</span>
<span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;stdio.h&gt;</span>
<span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;stdlib.h&gt;</span>
<span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;stdbool.h&gt;</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">RELU is a rectified linear unit. These are popular in convolutional neural networks</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">they are 0 for 0 and negative numbers and they are the identity for positive numbers.</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">RELU(-100) = RELU(-1) = 0 &amp;&amp; RELU(1) = 1 &amp;&amp; RELU(100) = 100</span>
<span style="color: #483d8b;">#define</span> <span style="color: #0000ff;">RELU</span>(<span style="color: #a0522d;">x</span>)  (( x &lt; 0 )?0:x)

<span style="color: #228b22;">int</span> <span style="color: #0000ff;">main</span>() {
    <span style="color: #228b22;">double</span> <span style="color: #a0522d;">x</span> = 2.0;
    <span style="color: #228b22;">double</span> <span style="color: #a0522d;">y</span> = 127.1;
    <span style="color: #b22222;">// </span><span style="color: #b22222;">How many times will pow(x,y) run?</span>
    printf(<span style="color: #8b2252;">"%f\n"</span>, RELU(pow(x,y)));

}
</pre>
</div>

<pre class="example">
1.8235280531744908e+38
</pre>


<div class="org-src-container">
<pre class="src src-sh">gcc -E -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 <span style="color: #8b2252;">\</span>
       relu2.c &gt; <span style="color: #8b2252;">\</span>
       relu2-expanded.c
</pre>
</div>

<p>
<a href="relu2-expanded.c">relu2-expanded.c</a>
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #483d8b;">#define</span> <span style="color: #0000ff;">RELU</span>(<span style="color: #a0522d;">x</span>) (( x &lt; 0 )?0:x)


<span style="color: #483d8b;"># 11</span> <span style="color: #8b2252;">"relu2.c"</span>
<span style="color: #228b22;">int</span> <span style="color: #0000ff;">main</span>() {
    <span style="color: #228b22;">double</span> <span style="color: #a0522d;">x</span> = 2.0;
    <span style="color: #228b22;">double</span> <span style="color: #a0522d;">y</span> = 127.1;
    <span style="color: #b22222;">// </span><span style="color: #b22222;">Uh oh how many pows?</span>
    printf(<span style="color: #8b2252;">"%f\n"</span>, (( pow(x,y) &lt; 0 )?0:pow(x,y)));

}
</pre>
</div>
</div>

<ol class="org-ol">
<li><a id="orgff7addb"></a>Easy bugs!<br />
<div class="outline-text-5" id="text-1-5-6-1">
<p>
So why doesn't this work?
</p>

<p>
<a href="./checkinputmacro.c">./checkinputmacro.c</a>
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;stdio.h&gt;</span>
<span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;stdlib.h&gt;</span>
<span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;stdbool.h&gt;</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">if checkinput is true then you have an error</span>
<span style="color: #483d8b;">#define</span> <span style="color: #0000ff;">CHECKINPUT</span>(<span style="color: #a0522d;">scanfReturn</span>)  ( scanfReturn == EOF || !scanfReturn )

<span style="color: #228b22;">int</span> <span style="color: #0000ff;">main</span>() {
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">myInt</span> = 0;
    <span style="color: #a020f0;">if</span> (CHECKINPUT(scanf(<span style="color: #8b2252;">"%d"</span>, &amp;myInt))) {
        printf(<span style="color: #8b2252;">"Invalid input!\n"</span>);
        exit(1);
    }
    printf(<span style="color: #8b2252;">"My int: %d\n"</span>, myInt);
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">gcc  -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 <span style="color: #8b2252;">\</span>
       -o checkinputmacro checkinputmacro.c
<span style="color: #483d8b;">echo</span> 6  | ./checkinputmacro
<span style="color: #483d8b;">echo</span> 6 7 | ./checkinputmacro
<span style="color: #483d8b;">echo</span> 6 X | ./checkinputmacro || <span style="color: #483d8b;">echo</span> exit was $<span style="color: #a0522d;">?</span>
<span style="color: #483d8b;">echo</span> X 6 | ./checkinputmacro || <span style="color: #483d8b;">echo</span> exit was $<span style="color: #a0522d;">?</span>
<span style="color: #483d8b;">echo</span> | ./checkinputmacro || <span style="color: #483d8b;">echo</span> exit was $<span style="color: #a0522d;">?</span>
</pre>
</div>

<pre class="example">
My int: 6
My int: 7
Invalid input!
exit was 1
Invalid input!
exit was 1
Invalid input!
exit was 1
</pre>


<div class="org-src-container">
<pre class="src src-sh">gcc -E -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 <span style="color: #8b2252;">\</span>
       checkinputmacro.c &gt; <span style="color: #8b2252;">\</span>
       checkinputmacro-expanded.c
</pre>
</div>

<p>
<a href="checkinputmacro-expanded.c">checkinputmacro-expanded.c</a>
</p>

<p>
Let's look at the output:
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #483d8b;">#define</span> <span style="color: #0000ff;">CHECKINPUT</span>(<span style="color: #a0522d;">scanfReturn</span>) ( scanfReturn == <span style="color: #008b8b;">false</span> || scanfReturn == EOF)

<span style="color: #483d8b;"># 8</span> <span style="color: #8b2252;">"checkinputmacro.c"</span>
<span style="color: #228b22;">int</span> <span style="color: #0000ff;">main</span>() {
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">myInt</span> = 0;
    <span style="color: #a020f0;">if</span> (( scanf(<span style="color: #8b2252;">"%d"</span>, &amp;myInt) == 
<span style="color: #483d8b;"># 10</span> <span style="color: #8b2252;">"checkinputmacro.c"</span> 3 4
       0 
<span style="color: #483d8b;"># 10</span> <span style="color: #8b2252;">"checkinputmacro.c"</span>
       || scanf(<span style="color: #8b2252;">"%d"</span>, &amp;myInt) == 
<span style="color: #483d8b;"># 10</span> <span style="color: #8b2252;">"checkinputmacro.c"</span> 3 4
       (-1)
<span style="color: #483d8b;"># 10</span> <span style="color: #8b2252;">"checkinputmacro.c"</span>
       )) {
        printf(<span style="color: #8b2252;">"Invalid input!\n"</span>);
        exit(1);
    }
    printf(<span style="color: #8b2252;">"My int: %d\n"</span>, myInt);
}
</pre>
</div>

<p>
I'll clear it up for you
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #483d8b;">#define</span> <span style="color: #0000ff;">CHECKINPUT</span>(<span style="color: #a0522d;">scanfReturn</span>) ( scanfReturn == <span style="color: #008b8b;">false</span> || scanfReturn == EOF)

<span style="color: #228b22;">int</span> <span style="color: #0000ff;">main</span>() {
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">myInt</span> = 0;
    <span style="color: #a020f0;">if</span> (( scanf(<span style="color: #8b2252;">"%d"</span>, &amp;myInt) ==  0 || scanf(<span style="color: #8b2252;">"%d"</span>, &amp;myInt) == (-1))) {
        printf(<span style="color: #8b2252;">"Invalid input!\n"</span>);
        exit(1);
    }
    printf(<span style="color: #8b2252;">"My int: %d\n"</span>, myInt);
}
</pre>
</div>

<p>
See? 2 scanfs instead of 1. Great. So macros will copy your tokens,
not your values. They are meta-functions and not real functions.
</p>

<p>
How do we fix? We assign the result once!
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;stdio.h&gt;</span>
<span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;stdlib.h&gt;</span>
<span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;stdbool.h&gt;</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">if checkinput is true then you have an error</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">horrible and bad style don't do this at home!</span>
<span style="color: #a020f0;">static</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">__ret</span>;
<span style="color: #483d8b;">#define</span> <span style="color: #0000ff;">CHECKINPUT</span>(<span style="color: #a0522d;">scanfReturn</span>)  (__ret = scanfReturn, (__ret== EOF || !__ret ))

<span style="color: #228b22;">int</span> <span style="color: #0000ff;">main</span>() {
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">myInt</span> = 0;
    <span style="color: #a020f0;">if</span> (CHECKINPUT(scanf(<span style="color: #8b2252;">"%d"</span>, &amp;myInt))) {
        printf(<span style="color: #8b2252;">"Invalid input!\n"</span>);
        exit(1);
    }
    printf(<span style="color: #8b2252;">"My int: %d\n"</span>, myInt);
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">gcc  -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 <span style="color: #8b2252;">\</span>
       -o checkinputmacro-fixed checkinputmacro-fixed.c
<span style="color: #483d8b;">echo</span>   | ./checkinputmacro-fixed
<span style="color: #483d8b;">echo</span> X | ./checkinputmacro-fixed
<span style="color: #483d8b;">echo</span> 6 | ./checkinputmacro-fixed
</pre>
</div>

<pre class="example">
Invalid input!
Invalid input!
My int: 6
</pre>


<div class="org-src-container">
<pre class="src src-sh">gcc -E -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 <span style="color: #8b2252;">\</span>
       checkinputmacro-fixed.c &gt; <span style="color: #8b2252;">\</span>
       checkinputmacro-fixed-expanded.c
</pre>
</div>

<p>
<a href="checkinputmacro-fixed-expanded.c">checkinputmacro-fixed-expanded.c</a>
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #483d8b;"># 7</span> <span style="color: #8b2252;">"checkinputmacro-fixed.c"</span>
<span style="color: #a020f0;">static</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">__ret</span>;
<span style="color: #483d8b;">#define</span> <span style="color: #0000ff;">CHECKINPUT</span>(<span style="color: #a0522d;">scanfReturn</span>) (__ret = scanfReturn, (__ret== EOF || !__ret ))

<span style="color: #228b22;">int</span> <span style="color: #0000ff;">main</span>() {
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">myInt</span> = 0;
    <span style="color: #a020f0;">if</span> ((__ret = scanf(<span style="color: #8b2252;">"%d"</span>, &amp;myInt), (__ret== 
<span style="color: #483d8b;"># 12</span> <span style="color: #8b2252;">"checkinputmacro-fixed.c"</span> 3 4
       (-1) 
<span style="color: #483d8b;"># 12</span> <span style="color: #8b2252;">"checkinputmacro-fixed.c"</span>
       || !__ret ))) {
        printf(<span style="color: #8b2252;">"Invalid input!\n"</span>);
        exit(1);
    }
    printf(<span style="color: #8b2252;">"My int: %d\n"</span>, myInt);
}
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-orgee34168" class="outline-3">
<h3 id="orgee34168"><span class="section-number-3">1.6</span> Makefiles</h3>
<div class="outline-text-3" id="text-1-6">
<p>
I am sick to death of all these shell scripts!
</p>

<p>
Look at the assignments 1 shell script per question and they mostly
say the same things.
</p>

<p>
Programmers uses build systems to manage compiling and linking large
programs. They often do not use shell scripts or batch files directly.
</p>

<p>
Makefiles allow you to use make to build your program. Make is
declarative, dependency based build system.
</p>

<p>
Makefiles are full of rules for building files.
</p>

<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #0000ff;">file-you-want-to-build</span>: dependency1.c dependency2.o dependency3.o
        gcc -o file-you-want-to-build dependency1.c dependency2.o dependency3.o
</pre>
</div>

<p>
^^^ There is a tab character before the gcc 
</p>

<p>
To build file-you-want-to-build you type:
</p>

<p>
make file-you-want-to-build
</p>

<p>
make
</p>
</div>

<div id="outline-container-org66d2aed" class="outline-4">
<h4 id="org66d2aed"><span class="section-number-4">1.6.1</span> Basic Makefile</h4>
<div class="outline-text-4" id="text-1-6-1">
<p>
We're going to use the coolbears source code from before.
</p>

<p>
Instead of this:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">build coolbears.o</span>
gcc  -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 <span style="color: #8b2252;">\</span>
       -c coolbears.c
<span style="color: #b22222;"># </span><span style="color: #b22222;">build coolbears-driver and link it to coolbears.o</span>
gcc  -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 <span style="color: #8b2252;">\</span>
       -o coolbears-driver coolbears-driver.c <span style="color: #8b2252;">\</span>
       coolbears.o 
./coolbears-driver
</pre>
</div>

<pre class="example">
The coolest bear is Kevin
</pre>


<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #b22222;"># </span><span style="color: #b22222;">this just runs a command but ensures it is built</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">first directive runs by default</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">usually you should but put the top level build directive here</span>
<span style="color: #0000ff;">run</span>: coolbears-driver
        ./coolbears-driver <span style="color: #b22222;"># </span><span style="color: #b22222;">just a shell command</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">build an object file</span>
<span style="color: #0000ff;">coolbears.o</span>: coolbears.c
        gcc  -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 \
        -c coolbears.c

<span style="color: #b22222;"># </span><span style="color: #b22222;">build an executable</span>
<span style="color: #0000ff;">coolbears-driver</span>: coolbears-driver.c coolbears.o
        gcc  -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 \
        -o coolbears-driver coolbears-driver.c \
        coolbears.o 

<span style="color: #b22222;"># </span><span style="color: #b22222;">clean is idiomatic for remove object files and executables</span>
<span style="color: #0000ff;">clean</span>: 
        rm -f coolbears.o coolbears-driver

</pre>
</div>

<p>
let's run it. Normally make just runs Makefile. But if you have your
own makefiles you should use the -f option with make.
</p>

<div class="org-src-container">
<pre class="src src-sh">make -f Makefile.coolbears clean
make -f Makefile.coolbears coolbears.o
make -f Makefile.coolbears coolbears-driver
make -f Makefile.coolbears run
</pre>
</div>

<pre class="example">
rm coolbears.o coolbears-driver || echo nothing to delete
gcc  -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 \
        -c coolbears.c
gcc  -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 \
-o coolbears-driver coolbears-driver.c \
coolbears.o 
./coolbears-driver # just a shell command
The coolest bear is Kevin
</pre>


<p>
Or we could just do this:
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">I am making clean just to clear out the executables and object files</span>
make -f Makefile.coolbears clean
make -f Makefile.coolbears run
</pre>
</div>

<pre class="example">
rm coolbears.o coolbears-driver || echo nothing to delete
gcc  -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 \
        -c coolbears.c
gcc  -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 \
-o coolbears-driver coolbears-driver.c \
coolbears.o 
./coolbears-driver # just a shell command
The coolest bear is Kevin
</pre>


<p>
OR we could do this!
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">I am making clean just to clear out the executables and object files</span>
make -f Makefile.coolbears clean
make -f Makefile.coolbears
</pre>
</div>

<pre class="example">
rm coolbears.o coolbears-driver || echo nothing to delete
gcc  -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 \
        -c coolbears.c
gcc  -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 \
-o coolbears-driver coolbears-driver.c \
coolbears.o 
./coolbears-driver # just a shell command
The coolest bear is Kevin
</pre>


<p>
Ha it does the same thing!
</p>


<p>
What if I run make again?
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">I am making clean just to clear out the executables and object files</span>
make -f Makefile.coolbears
</pre>
</div>

<pre class="example">
./coolbears-driver # just a shell command
The coolest bear is Kevin
</pre>


<p>
It just uses the old object files.
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">if I remove the executable it'll rebuild only the executable</span>
rm coolbears-driver
make -f Makefile.coolbears
</pre>
</div>

<pre class="example">
gcc  -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 \
-o coolbears-driver coolbears-driver.c \
coolbears.o 
./coolbears-driver # just a shell command
The coolest bear is Kevin
</pre>


<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">if I remove the object files it'll build the whole thing</span>
rm *.o
make -f Makefile.coolbears
</pre>
</div>

<pre class="example">
gcc  -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 \
        -c coolbears.c
gcc  -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 \
-o coolbears-driver coolbears-driver.c \
coolbears.o 
./coolbears-driver # just a shell command
The coolest bear is Kevin
</pre>



<p>
Personally I would've preferred if assignments were done this way.
</p>
</div>
</div>

<div id="outline-container-org8fd023c" class="outline-4">
<h4 id="org8fd023c"><span class="section-number-4">1.6.2</span> DRY Makefile</h4>
<div class="outline-text-4" id="text-1-6-2">
<p>
DRY means DON'T REPEAT YOURSELF.
</p>

<p>
Let's make a makefile that is easier to use and less prone to errors
by repeating text.
</p>

<p>
Instead of this:
</p>

<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #b22222;"># </span><span style="color: #b22222;">this just runs a command but ensures it is built</span>
<span style="color: #0000ff;">run</span>: coolbears-driver
        ./coolbears-driver <span style="color: #b22222;"># </span><span style="color: #b22222;">just a shell command</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">build an object file</span>
<span style="color: #0000ff;">coolbears.o</span>: coolbears.c
        gcc  -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 \
        -c coolbears.c

<span style="color: #b22222;"># </span><span style="color: #b22222;">build an executable</span>
<span style="color: #0000ff;">coolbears-driver</span>: coolbears-driver.c coolbears.o
        gcc  -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 \
        -o coolbears-driver coolbears-driver.c \
        coolbears.o 

<span style="color: #b22222;"># </span><span style="color: #b22222;">clean is idiomatic for remove object files and executables</span>
<span style="color: #0000ff;">clean</span>: 
        rm -f coolbears.o coolbears-driver || echo nothing to delete


</pre>
</div>

<p>
We're going to automate our Makefile a little more with variables.
</p>

<p>
You can make a variable in a makefile by going
   VARNAME=some string of stuff
   LISTNAME=item1 item2 item3 item4
   SCALARNAME="SCALAR VALUE"
</p>

<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #b22222;"># </span><span style="color: #b22222;">common arguments for GCC</span>
<span style="color: #a0522d;">CFLAGS</span>= -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3
<span style="color: #b22222;"># </span><span style="color: #b22222;">Common compiler</span>
<span style="color: #a0522d;">CC</span>=gcc
<span style="color: #b22222;"># </span><span style="color: #b22222;">you might call these OBJECTS instead</span>
<span style="color: #a0522d;">BUILDABLES</span>=coolbears.o coolbears-driver

<span style="color: #b22222;"># </span><span style="color: #b22222;">this just runs a command but ensures it is built</span>
<span style="color: #0000ff;">run</span>: coolbears-driver
        ./coolbears-driver <span style="color: #b22222;"># </span><span style="color: #b22222;">just a shell command</span>

<span style="color: #0000ff;">coolbears.o</span>: coolbears.c
        $(<span style="color: #a0522d;">CC</span>) $(<span style="color: #a0522d;">CFLAGS</span>) \
        -c coolbears.c

<span style="color: #b22222;"># </span><span style="color: #b22222;">build an executable</span>
<span style="color: #0000ff;">coolbears-driver</span>: coolbears-driver.c coolbears.o
        $(<span style="color: #a0522d;">CC</span>) $(<span style="color: #a0522d;">CFLAGS</span>) \
        -o coolbears-driver coolbears-driver.c \
        coolbears.o 

<span style="color: #b22222;"># </span><span style="color: #b22222;">clean is idiomatic for remove object files and executables</span>
<span style="color: #0000ff;">clean</span>: 
        rm -f $(<span style="color: #a0522d;">BUILDABLES</span>)
</pre>
</div>

<p>
let's run it. Normally make just runs Makefile. But if you have your
own makefiles you should use the -f option with make.
</p>

<div class="org-src-container">
<pre class="src src-sh">make -f Makefile.coolbears.dry run
</pre>
</div>

<pre class="example">
./coolbears-driver # just a shell command
The coolest bear is Kevin
</pre>
</div>
</div>

<div id="outline-container-org99debfe" class="outline-4">
<h4 id="org99debfe"><span class="section-number-4">1.6.3</span> Idiomatic GCC Makefile</h4>
<div class="outline-text-4" id="text-1-6-3">
<p>
Make knows a lot about C. Make comes with default rules that will call
your compiler for you as long as CFLAGS and CC are properly set!
</p>

<p>
This means it knows how to make an executable. 
</p>

<p>
It knows how to make an object file. It just needs to know the
dependencies.
</p>

<p>
You can reuse this makefile as well!
</p>

<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #b22222;"># </span><span style="color: #b22222;">common arguments for GCC</span>
<span style="color: #a0522d;">CFLAGS</span>= -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3
<span style="color: #b22222;"># </span><span style="color: #b22222;">Do you need your math lib? Put it here this is the linking libraries</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">variable</span>
<span style="color: #a0522d;">LDLIBS</span>=-lm
<span style="color: #b22222;"># </span><span style="color: #b22222;">Common compiler</span>
<span style="color: #a0522d;">CC</span>=gcc
<span style="color: #a0522d;">OBJECTS</span>=coolbears.o coolbears-driver.o
<span style="color: #a0522d;">EXEC</span>=coolbears-driver
<span style="color: #a0522d;">BUILDABLES</span>=$(<span style="color: #a0522d;">OBJECTS</span>) $(<span style="color: #a0522d;">EXEC</span>)

<span style="color: #b22222;"># </span><span style="color: #b22222;">this just runs a command but ensures it is built</span>
<span style="color: #0000ff;">run</span>: $(<span style="color: #a0522d;">EXEC</span>)
        ./$(<span style="color: #a0522d;">EXEC</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">just a shell command</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">We don't even need to specify how to make coolbears.o</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">try commenting and uncommenting this line</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">coolbears.o: coolbears.c</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">build an executable</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">coolbears-driver: coolbears-driver.c coolbears.o</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;"># this would work too</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">coolbears-driver: coolbears-driver.o coolbears.o</span>

<span style="color: #0000ff;">$(</span><span style="color: #0000ff;">EXEC</span><span style="color: #0000ff;">)</span>: $(<span style="color: #a0522d;">OBJECTS</span>)


<span style="color: #b22222;"># </span><span style="color: #b22222;">clean is idiomatic for remove object files and executables</span>
<span style="color: #0000ff;">clean</span>: 
        rm -f $(<span style="color: #a0522d;">BUILDABLES</span>)
</pre>
</div>

<p>
let's run it. Normally make just runs Makefile. But if you have your
own makefiles you should use the -f option with make.
</p>

<div class="org-src-container">
<pre class="src src-sh">make -f Makefile.coolbears.idiomatic clean
make -f Makefile.coolbears.idiomatic run
</pre>
</div>

<pre class="example">
rm coolbears.o coolbears-driver.o coolbears-driver || echo nothing to delete
nothing to delete
gcc -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3   -c -o coolbears-driver.o coolbears-driver.c
gcc -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3   -c -o coolbears.o coolbears.c
gcc   coolbears-driver.o coolbears.o  -lm -o coolbears-driver
./coolbears-driver # just a shell command
The coolest bear is Kevin
</pre>
</div>
</div>

<div id="outline-container-orga64b233" class="outline-4">
<h4 id="orga64b233"><span class="section-number-4">1.6.4</span> Special Macro Vars</h4>
<div class="outline-text-4" id="text-1-6-4">
<ul class="org-ul">
<li>$@ the target file name</li>

<li>$&lt; the first dependency</li>

<li>$? new dependencies that have changed</li>

<li>$^ all dependencies</li>

<li>$* target suffix</li>
</ul>

<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #a0522d;">OBJECTS</span>=example.txt 1.txt 2.txt 3.txt

<span style="color: #0000ff;">run</span>: example.txt
        echo <span style="color: #0000ff;">$</span><span style="color: #008b8b;">@</span> $<span style="color: #008b8b;">&lt;</span> <span style="color: #0000ff;">$</span><span style="color: #008b8b;">*</span>
        cat example.txt

<span style="color: #0000ff;">example.txt</span>: 1.txt 2.txt 3.txt
        echo First Dependency $<span style="color: #008b8b;">&lt;</span>
        echo Target <span style="color: #0000ff;">$</span><span style="color: #008b8b;">@</span>
        echo New Deps $<span style="color: #008b8b;">?</span>
        echo All Deps $<span style="color: #008b8b;">^</span>
        echo target suffix <span style="color: #0000ff;">$</span><span style="color: #008b8b;">*</span>
        cat $<span style="color: #008b8b;">^</span> &gt; example.txt

<span style="color: #0000ff;">1.txt</span>:
        echo <span style="color: #0000ff;">$</span><span style="color: #008b8b;">@</span> &gt; <span style="color: #0000ff;">$</span><span style="color: #008b8b;">@</span>
<span style="color: #0000ff;">2.txt</span>:
        echo <span style="color: #0000ff;">$</span><span style="color: #008b8b;">@</span> &gt; <span style="color: #0000ff;">$</span><span style="color: #008b8b;">@</span>
<span style="color: #0000ff;">3.txt</span>:
        echo <span style="color: #0000ff;">$</span><span style="color: #008b8b;">@</span> &gt; <span style="color: #0000ff;">$</span><span style="color: #008b8b;">@</span>

<span style="color: #0000ff;">clean</span>:
        rm $(<span style="color: #a0522d;">OBJECTS</span>) || echo all good
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">make -f Makefile.macros clean
make -f Makefile.macros
</pre>
</div>

<pre class="example">
rm example.txt 1.txt 2.txt 3.txt || echo all good
echo 1.txt &gt; 1.txt
echo 2.txt &gt; 2.txt
echo 3.txt &gt; 3.txt
echo First Dependency 1.txt
First Dependency 1.txt
echo Target example.txt
Target example.txt
echo New Deps 1.txt 2.txt 3.txt
New Deps 1.txt 2.txt 3.txt
echo All Deps 1.txt 2.txt 3.txt
All Deps 1.txt 2.txt 3.txt
echo target suffix 
target suffix
cat 1.txt 2.txt 3.txt &gt; example.txt
echo run example.txt 
run example.txt
cat example.txt
1.txt
2.txt
3.txt
</pre>
</div>

<ol class="org-ol">
<li><a id="orge465182"></a>Implicit Rules<br />
<div class="outline-text-5" id="text-1-6-4-1">
<p>
Here's an example of implicit rules. Of how we convert 1 file to
another implicitly much like how Make hands C compilation.
</p>

<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #b22222;">############################### </span><span style="color: #b22222;">Implicit rules ###############################</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">Convert a .tex file to a .pdf</span>
<span style="color: #0000ff;">%.pdf</span>: %.tex $(<span style="color: #a0522d;">ALLDEPS</span>)
        latexmk -pdf $(<span style="color: #a0522d;">LATEXMK_OPTS</span>) <span style="color: #0000ff;">$</span><span style="color: #008b8b;">*</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">Convert SVGs to PDFs</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Requires Inkscape</span>
<span style="color: #0000ff;">%.pdf</span>: %.svg
        inkscape -b white -t -T --export-ignore-filters --export-pdfs=<span style="color: #0000ff;">$</span><span style="color: #008b8b;">@</span> $<span style="color: #008b8b;">&lt;</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">Convert EPSs to PDFs</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">epstopdf(1) is often bundled with TeX distributions</span>
<span style="color: #0000ff;">%.pdf</span>: %.eps
        epstopdf $<span style="color: #008b8b;">&lt;</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">Automatically crops the margins of a PDF.</span>
<span style="color: #0000ff;">%-crop.pdf</span>: %.pdf
        pdfcrop $<span style="color: #008b8b;">&lt;</span>
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-org26df4eb" class="outline-4">
<h4 id="org26df4eb"><span class="section-number-4">1.6.5</span> Can we lint and valgrind with our makefiles?</h4>
<div class="outline-text-4" id="text-1-6-5">
<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #b22222;"># </span><span style="color: #b22222;">common arguments for GCC</span>
<span style="color: #a0522d;">CFLAGS</span>= -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3
<span style="color: #b22222;"># </span><span style="color: #b22222;">Common compiler</span>
<span style="color: #a0522d;">CC</span>=gcc
<span style="color: #b22222;"># </span><span style="color: #b22222;">you might call these OBJECTS instead</span>
<span style="color: #a0522d;">BUILDABLES</span>=coolbears.o coolbears-driver
<span style="color: #b22222;"># </span><span style="color: #b22222;">clangtidy checks</span>
<span style="color: #a0522d;">CHECKS</span>=--checks=*,-cert-err34-c,-cert-msc30-c,-cert-msc50-cpp
<span style="color: #b22222;"># </span><span style="color: #b22222;">oclint checks</span>
<span style="color: #a0522d;">LINTR</span>=--disable-rule=UselessParentheses
<span style="color: #a0522d;">CLANGTIDY</span>=clang-tidy
<span style="color: #a0522d;">OCLINT</span>=oclint
<span style="color: #0000ff;">.PHONY</span>: run clean lint-coolbears-driver

<span style="color: #b22222;"># </span><span style="color: #b22222;">this just runs a command but ensures it is built</span>
<span style="color: #0000ff;">run</span>: coolbears-driver
        ./coolbears-driver <span style="color: #b22222;"># </span><span style="color: #b22222;">just a shell command</span>

<span style="color: #0000ff;">coolbears.o</span>: coolbears.c coolbears.h
        $(<span style="color: #a0522d;">CC</span>) $(<span style="color: #a0522d;">CFLAGS</span>) \
        -c coolbears.c

<span style="color: #0000ff;">coolbears-driver.o</span>: coolbears-driver.c coolbears.c
        $(<span style="color: #a0522d;">CC</span>) $(<span style="color: #a0522d;">CFLAGS</span>) \
        -c coolbears.c

<span style="color: #b22222;"># </span><span style="color: #b22222;">build an executable</span>
<span style="color: #0000ff;">coolbears-driver</span>: coolbears-driver.o coolbears.o
        $(<span style="color: #a0522d;">CC</span>) $(<span style="color: #a0522d;">CFLAGS</span>) \
        -o coolbears-driver coolbears-driver.o \
        coolbears.o 

<span style="color: #b22222;"># </span><span style="color: #b22222;">clean is idiomatic for remove object files and executables</span>
<span style="color: #0000ff;">clean</span>: 
        rm -f $(<span style="color: #a0522d;">BUILDABLES</span>) 

<span style="color: #0000ff;">lint-coolbears-driver</span>: coolbears-driver.c
        $(<span style="color: #a0522d;">CLANGTIDY</span>) $(<span style="color: #a0522d;">CHECKS</span>) \
                $<span style="color: #008b8b;">&lt;</span> -- \
                $(<span style="color: #a0522d;">CFLAGS</span>) -c $<span style="color: #008b8b;">^</span> $(<span style="color: #a0522d;">LDFLAGS</span>)
        $(<span style="color: #a0522d;">OCLINT</span>) $(<span style="color: #a0522d;">LINTR</span>) $<span style="color: #008b8b;">&lt;</span> \
                -- $(<span style="color: #a0522d;">CFLAGS</span>) -c $<span style="color: #008b8b;">&lt;</span> $(<span style="color: #a0522d;">LDFLAGS</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">make -f Makefile.coolbears.lint lint-coolbears-driver
</pre>
</div>

<pre class="example">
clang-tidy --checks=*,-cert-err34-c,-cert-msc30-c,-cert-msc50-cpp \
	coolbears-driver.c -- \
	-std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -c coolbears-driver.c 
/home/hindle1/projects/CMPUT201W20/2020-01/CMPUT201W20B2-public/week10/coolbears-driver.c:5:43: warning: narrowing conversion from 'double' to 'float' [bugprone-narrowing-conversions]
  CoolBear ziggy = createCoolBear("Ziggy",-23.0 /* C */);
                                          ^
/home/hindle1/projects/CMPUT201W20/2020-01/CMPUT201W20B2-public/week10/coolbears-driver.c:5:44: warning: 23.0 is a magic number; consider replacing it with a named constant [cppcoreguidelines-avoid-magic-numbers]
  CoolBear ziggy = createCoolBear("Ziggy",-23.0 /* C */);
                                           ^
/home/hindle1/projects/CMPUT201W20/2020-01/CMPUT201W20B2-public/week10/coolbears-driver.c:6:43: warning: narrowing conversion from 'double' to 'float' [bugprone-narrowing-conversions]
  CoolBear kevin = createCoolBear("Kevin",-32.0 /* C */);
                                          ^
/home/hindle1/projects/CMPUT201W20/2020-01/CMPUT201W20B2-public/week10/coolbears-driver.c:6:44: warning: 32.0 is a magic number; consider replacing it with a named constant [cppcoreguidelines-avoid-magic-numbers]
  CoolBear kevin = createCoolBear("Kevin",-32.0 /* C */);
                                           ^
oclint --disable-rule=UselessParentheses coolbears-driver.c \
	-- -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -c coolbears-driver.c 


OCLint Report

Summary: TotalFiles=1 FilesWithViolations=0 P1=0 P2=0 P3=0 


[OCLint (http://oclint.org) v0.15]
</pre>

<p>
We can go further:
</p>

<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #b22222;"># </span><span style="color: #b22222;">common arguments for GCC</span>
<span style="color: #a0522d;">CFLAGS</span>= -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3
<span style="color: #b22222;"># </span><span style="color: #b22222;">Common compiler</span>
<span style="color: #a0522d;">CC</span>=gcc
<span style="color: #b22222;"># </span><span style="color: #b22222;">you might call these OBJECTS instead</span>
<span style="color: #a0522d;">BUILDABLES</span>=coolbears.o coolbears-driver
<span style="color: #b22222;"># </span><span style="color: #b22222;">clangtidy checks</span>
<span style="color: #a0522d;">CHECKS</span>=--checks=*,-cert-err34-c,-cert-msc30-c,-cert-msc50-cpp
<span style="color: #b22222;"># </span><span style="color: #b22222;">oclint checks</span>
<span style="color: #a0522d;">LINTR</span>=--disable-rule=UselessParentheses
<span style="color: #a0522d;">CLANGTIDY</span>=clang-tidy
<span style="color: #a0522d;">OCLINT</span>=oclint
<span style="color: #a0522d;">HEADERS</span>=coolbears.h
<span style="color: #a0522d;">OBJECTS</span>=coolbears.o coolbears-driver.o
<span style="color: #a0522d;">EXECUTABLE</span>=coolbears-driver

<span style="color: #0000ff;">.PHONY</span>: lint-% run clean valgrind

<span style="color: #b22222;"># </span><span style="color: #b22222;">this just runs a command but ensures it is built</span>
<span style="color: #0000ff;">run</span>: $(<span style="color: #a0522d;">EXECUTABLE</span>)
        ./$(<span style="color: #a0522d;">EXECUTABLE</span>)

<span style="color: #0000ff;">%.o</span>: %.c $(<span style="color: #a0522d;">HEADERS</span>)
        $(<span style="color: #a0522d;">CC</span>) $(<span style="color: #a0522d;">CFLAGS</span>) -c $<span style="color: #008b8b;">&lt;</span>
<span style="color: #b22222;">#       </span><span style="color: #b22222;">$(</span><span style="color: #a0522d;">CLANGTIDY</span><span style="color: #b22222;">) $(</span><span style="color: #a0522d;">CHECKS</span><span style="color: #b22222;">) \</span>
<span style="color: #b22222;">#               $</span><span style="color: #008b8b;">&lt;</span><span style="color: #b22222;"> -- \</span>
<span style="color: #b22222;">#               $(</span><span style="color: #a0522d;">CFLAGS</span><span style="color: #b22222;">) -c $</span><span style="color: #008b8b;">&lt;</span><span style="color: #b22222;"> $(</span><span style="color: #a0522d;">LDFLAGS</span><span style="color: #b22222;">)</span>
<span style="color: #b22222;">#       </span><span style="color: #b22222;">$(</span><span style="color: #a0522d;">OCLINT</span><span style="color: #b22222;">) $(</span><span style="color: #a0522d;">LINTR</span><span style="color: #b22222;">) $</span><span style="color: #008b8b;">&lt;</span><span style="color: #b22222;"> \</span>
<span style="color: #b22222;">#               -- $(</span><span style="color: #a0522d;">CFLAGS</span><span style="color: #b22222;">) -c $</span><span style="color: #008b8b;">&lt;</span><span style="color: #b22222;"> $(</span><span style="color: #a0522d;">LDFLAGS</span><span style="color: #b22222;">)</span>


<span style="color: #0000ff;">$(</span><span style="color: #0000ff;">EXECUTABLE</span><span style="color: #0000ff;">)</span>: $(<span style="color: #a0522d;">OBJECTS</span>)
        $(<span style="color: #a0522d;">CC</span>) $(<span style="color: #a0522d;">CFLAGS</span>) -o <span style="color: #0000ff;">$</span><span style="color: #008b8b;">@</span> $<span style="color: #008b8b;">^</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">clean is idiomatic for remove object files and executables</span>
<span style="color: #0000ff;">clean</span>: 
        rm -f $(<span style="color: #a0522d;">EXECUTABLE</span>) $(<span style="color: #a0522d;">OBJECTS</span>) 

<span style="color: #0000ff;">lint-%</span>: %.c
        $(<span style="color: #a0522d;">CLANGTIDY</span>) $(<span style="color: #a0522d;">CHECKS</span>) \
                $<span style="color: #008b8b;">&lt;</span> -- \
                $(<span style="color: #a0522d;">CFLAGS</span>) -c $<span style="color: #008b8b;">&lt;</span> $(<span style="color: #a0522d;">LDFLAGS</span>)
        $(<span style="color: #a0522d;">OCLINT</span>) $(<span style="color: #a0522d;">LINTR</span>) $<span style="color: #008b8b;">&lt;</span> \
                -- $(<span style="color: #a0522d;">CFLAGS</span>) -c $<span style="color: #008b8b;">&lt;</span> $(<span style="color: #a0522d;">LDFLAGS</span>)

<span style="color: #b22222;"># </span><span style="color: #b22222;">Lookie here how these 2 valgrinds are very similar</span>
<span style="color: #0000ff;">valgrind-%</span>: %
        valgrind --leak-check=full --track-origins=yes ./$<span style="color: #008b8b;">&lt;</span> 2&gt;&amp;1

<span style="color: #0000ff;">valgrind</span>: $(<span style="color: #a0522d;">EXECUTABLE</span>)
        valgrind --leak-check=full --track-origins=yes ./$<span style="color: #008b8b;">&lt;</span> 2&gt;&amp;1

</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">make -f Makefile.coolbears.lint.dry lint-coolbears-driver
make -f Makefile.coolbears.lint.dry lint-coolbears
make -f Makefile.coolbears.lint.dry valgrind-coolbears-driver
</pre>
</div>

<pre class="example">
clang-tidy --checks=*,-cert-err34-c,-cert-msc30-c,-cert-msc50-cpp \
	coolbears-driver.c -- \
	-std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -c coolbears-driver.c 
/home/hindle1/projects/CMPUT201W20/2020-01/CMPUT201W20B2-public/week10/coolbears-driver.c:5:43: warning: narrowing conversion from 'double' to 'float' [bugprone-narrowing-conversions]
  CoolBear ziggy = createCoolBear("Ziggy",-23.0 /* C */);
                                          ^
/home/hindle1/projects/CMPUT201W20/2020-01/CMPUT201W20B2-public/week10/coolbears-driver.c:5:44: warning: 23.0 is a magic number; consider replacing it with a named constant [cppcoreguidelines-avoid-magic-numbers]
  CoolBear ziggy = createCoolBear("Ziggy",-23.0 /* C */);
                                           ^
/home/hindle1/projects/CMPUT201W20/2020-01/CMPUT201W20B2-public/week10/coolbears-driver.c:6:43: warning: narrowing conversion from 'double' to 'float' [bugprone-narrowing-conversions]
  CoolBear kevin = createCoolBear("Kevin",-32.0 /* C */);
                                          ^
/home/hindle1/projects/CMPUT201W20/2020-01/CMPUT201W20B2-public/week10/coolbears-driver.c:6:44: warning: 32.0 is a magic number; consider replacing it with a named constant [cppcoreguidelines-avoid-magic-numbers]
  CoolBear kevin = createCoolBear("Kevin",-32.0 /* C */);
                                           ^
oclint --disable-rule=UselessParentheses coolbears-driver.c \
	-- -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -c coolbears-driver.c 


OCLint Report

Summary: TotalFiles=1 FilesWithViolations=0 P1=0 P2=0 P3=0 


[OCLint (http://oclint.org) v0.15]
clang-tidy --checks=*,-cert-err34-c,-cert-msc30-c,-cert-msc50-cpp \
	coolbears.c -- \
	-std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -c coolbears.c 
oclint --disable-rule=UselessParentheses coolbears.c \
	-- -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -c coolbears.c 


OCLint Report

Summary: TotalFiles=1 FilesWithViolations=0 P1=0 P2=0 P3=0 


[OCLint (http://oclint.org) v0.15]
valgrind --leak-check=full --track-origins=yes ./coolbears-driver 2&gt;&amp;1
==16719== Memcheck, a memory error detector
==16719== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.
==16719== Using Valgrind-3.13.0 and LibVEX; rerun with -h for copyright info
==16719== Command: ./coolbears-driver
==16719== 
The coolest bear is Kevin
==16719== 
==16719== HEAP SUMMARY:
==16719==     in use at exit: 0 bytes in 0 blocks
==16719==   total heap usage: 5 allocs, 5 frees, 4,140 bytes allocated
==16719== 
==16719== All heap blocks were freed -- no leaks are possible
==16719== 
==16719== For counts of detected and suppressed errors, rerun with: -v
==16719== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
</pre>
</div>
</div>

<div id="outline-container-org78b4acb" class="outline-4">
<h4 id="org78b4acb"><span class="section-number-4">1.6.6</span> .PHONY</h4>
<div class="outline-text-4" id="text-1-6-6">
<p>
Hazel says:
</p>

<p>
It is also often useful to have a rule that removes the compiled code
so that you can easily compile your program from scratch. This is
useful when you change your Makefile. We can add a phony rule named
clean so that when we run “make clean” on the command line it removes
all the compiler outputs: s-expr, s-expr.o, and main.o:
</p>
<div class="org-src-container">
<pre class="src src-Makefile">.PHONY: clean
clean:
       rm -f s-expr s-expr.o main.o
</pre>
</div>
<p>
This tells make:
</p>

<p>
“clean” is not an actual file that will be made, instead we should
run the recipe for “clean” everytime we make “clean”.
</p>

<p>
“clean” doesn’t have any input files that will change the output
(there is nothing after the colon :)
</p>

<p>
When we make “clean” we will remove the files s-expr, s-expr.o, and main.o.
</p>
</div>
</div>



<div id="outline-container-org5e91534" class="outline-4">
<h4 id="org5e91534"><span class="section-number-4">1.6.7</span> Makefile help</h4>
<div class="outline-text-4" id="text-1-6-7">
<p>
The GNU Manual is pretty good
</p>

<p>
<a href="https://www.gnu.org/software/make/manual/html_node/Introduction.html">https://www.gnu.org/software/make/manual/html_node/Introduction.html</a>
</p>

<p>
Hazel's write up is very good (UAlberta ONLY)
</p>

<p>
<a href="https://docs.google.com/document/d/1k8bAErdg6ju8reniMUhnkkjCtwUHWCM9mn59iHnI0rc/">https://docs.google.com/document/d/1k8bAErdg6ju8reniMUhnkkjCtwUHWCM9mn59iHnI0rc/</a>
</p>
</div>
</div>

<div id="outline-container-org622f2ba" class="outline-4">
<h4 id="org622f2ba"><span class="section-number-4">1.6.8</span> Useful Tool! asan and usan</h4>
<div class="outline-text-4" id="text-1-6-8">
<p>
Google made some static analysis tools to detect issues!
</p>

<p>
(From chefmax of Google (2020) <a href="https://github.com/google/sanitizers/wiki/AddressSanitizer">https://github.com/google/sanitizers/wiki/AddressSanitizer</a> )
</p>

<p>
Address sanitizer detects:
</p>

<ul class="org-ul">
<li>Use after free (dangling pointer dereference)</li>
<li>Heap buffer overflow</li>
<li>Stack buffer overflow</li>
<li>Global buffer overflow</li>
<li>Use after return</li>
<li>Use after scope</li>
<li>Initialization order bugs</li>
<li>Memory leaks</li>
</ul>

<p>
I've been telling y'all to use it in the discussion forum. It's like
valgrind but it does different things and has nice output.
</p>

<p>
How do you use it?
</p>

<p>
With clang or gcc add the argument
</p>

<p>
-fsanitize=address
-fsanitize=undefined
</p>

<p>
For address sanitization or undefined santitization.
</p>

<p>
If you want more options check out <a href="https://gcc.gnu.org/onlinedocs/gcc/Instrumentation-Options.html">https://gcc.gnu.org/onlinedocs/gcc/Instrumentation-Options.html</a>
</p>
</div>

<ol class="org-ol">
<li><a id="orgc716736"></a>./array<sub>oob.c</sub><br />
<div class="outline-text-5" id="text-1-6-8-1">
<p>
<a href="./array_oob.c">./array_oob.c</a>
</p>

<p>
Sanitize ./array<sub>oob.c</sub> with address!
</p>
<div class="org-src-container">
<pre class="src src-sh">gcc -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -fsanitize=address -o array_oob ./array_oob.c
<span style="color: #483d8b;">echo</span> 33 | ./array_oob 2&gt;&amp;1 || <span style="color: #483d8b;">echo</span> it crashed
</pre>
</div>

<pre class="example">
How big?
32768
32769
</pre>


<p>
And now with undefined!
</p>
<div class="org-src-container">
<pre class="src src-sh">gcc -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -fsanitize=undefined -o array_oob ./array_oob.c
<span style="color: #483d8b;">echo</span> 33 | ./array_oob 2&gt;&amp;1 || <span style="color: #483d8b;">echo</span> it crashed
</pre>
</div>

<pre class="example">
array_oob.c:27:25: runtime error: index 100 out of bounds for type 'int [*]'
array_oob.c:28:16: runtime error: index 100 out of bounds for type 'int [*]'
array_oob.c:29:25: runtime error: index 100 out of bounds for type 'int [*]'
How big?
1304645144
1304645145
</pre>
</div>
</li>

<li><a id="org26fce40"></a>./array<sub>uninit.c</sub><br />
<div class="outline-text-5" id="text-1-6-8-2">
<p>
<a href="./array_uninit.c">./array_uninit.c</a>
</p>

<p>
Sanitize ./array<sub>uninit.c</sub> with address!
</p>
<div class="org-src-container">
<pre class="src src-sh">gcc -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -fsanitize=address -o array_uninit ./array_uninit.c
<span style="color: #483d8b;">echo</span> 33 | ./array_uninit 2&gt;&amp;1 || <span style="color: #483d8b;">echo</span> it crashed
</pre>
</div>

<pre class="example">
How big?
8
0
385051187
32604
1
0
407373584
32604
1
0
8
0
388593504
32604
-1293348704
21893
388575904
32604
0
0
0
0
385006223
32604
0
0
152657632
32764
152657776
32764
152657728
32764
-2128401444
</pre>

<p>
And now with undefined!
</p>
<div class="org-src-container">
<pre class="src src-sh">gcc -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -fsanitize=undefined -o array_uninit ./array_uninit.c
<span style="color: #483d8b;">echo</span> 33 | ./array_uninit 2&gt;&amp;1 || <span style="color: #483d8b;">echo</span> it crashed
</pre>
</div>

<pre class="example">
How big?
8
0
1152096819
32633
0
0
0
0
0
0
8
0
1155639136
32633
579099989
22066
1155621536
32633
-1536167232
32765
0
0
1152051855
32633
0
0
0
0
-1536167120
32765
579099136
22066
0
</pre>
</div>
</li>

<li><a id="orgdbf25a5"></a>./bad<sub>realloc.c</sub><br />
<div class="outline-text-5" id="text-1-6-8-3">
<p>
<a href="./bad_realloc.c">./bad_realloc.c</a>
</p>

<p>
Sanitize ./bad<sub>realloc.c</sub> with address!
</p>
<div class="org-src-container">
<pre class="src src-sh">gcc -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -fsanitize=address -o bad_realloc ./bad_realloc.c
<span style="color: #483d8b;">echo</span> 33 | ./bad_realloc 2&gt;&amp;1 || <span style="color: #483d8b;">echo</span> it crashed
</pre>
</div>

<pre class="example">
ASAN:DEADLYSIGNAL
=================================================================
==16766==ERROR: AddressSanitizer: SEGV on unknown address 0x000000000000 (pc 0x5580633710f5 bp 0x7ffc7ccd54c0 sp 0x7ffc7ccd5490 T0)
==16766==The signal is caused by a READ memory access.
==16766==Hint: address points to the zero page.
    #0 0x5580633710f4 in push bad_realloc.c:54
    #1 0x5580633714b2 in push_input_lines bad_realloc.c:91
    #2 0x558063371616 in main bad_realloc.c:111
    #3 0x7fce5d2f1b96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)
    #4 0x558063370c99 in _start (/home/hindle1/projects/CMPUT201W20/2020-01/CMPUT201W20B2-public/week10/bad_realloc+0xc99)

AddressSanitizer can not provide additional info.
SUMMARY: AddressSanitizer: SEGV bad_realloc.c:54 in push
==16766==ABORTING
it crashed
</pre>

<p>
And now with undefined!
</p>
<div class="org-src-container">
<pre class="src src-sh">gcc -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -fsanitize=undefined -o bad_realloc ./bad_realloc.c
<span style="color: #483d8b;">echo</span> 33 | ./bad_realloc 2&gt;&amp;1 || <span style="color: #483d8b;">echo</span> it crashed
</pre>
</div>

<pre class="example">
it crashed
</pre>
</div>
</li>

<li><a id="orgfd50649"></a>./bad<sub>str.c</sub><br />
<div class="outline-text-5" id="text-1-6-8-4">
<p>
<a href="./bad_str.c">./bad_str.c</a>
</p>

<p>
Sanitize ./bad<sub>str.c</sub> with address!
</p>
<div class="org-src-container">
<pre class="src src-sh">gcc -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -fsanitize=address -o bad_str ./bad_str.c
<span style="color: #483d8b;">echo</span> 33 | ./bad_str 2&gt;&amp;1 || <span style="color: #483d8b;">echo</span> it crashed
</pre>
</div>

<pre class="example">

=================================================================
==16786==ERROR: LeakSanitizer: detected memory leaks

Direct leak of 5 byte(s) in 1 object(s) allocated from:
    #0 0x7f4523e73b40 in __interceptor_malloc (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xdeb40)
    #1 0x558d129afa7b in main bad_str.c:15
    #2 0x7f45239c5b96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)

SUMMARY: AddressSanitizer: 5 byte(s) leaked in 1 allocation(s).
it crashed
</pre>

<p>
And now with undefined!
</p>
<div class="org-src-container">
<pre class="src src-sh">gcc -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -fsanitize=undefined -o bad_str ./bad_str.c
<span style="color: #483d8b;">echo</span> 33 | ./bad_str 2&gt;&amp;1 || <span style="color: #483d8b;">echo</span> it crashed
</pre>
</div>

<pre class="example">
Enter a message:
You entered: 33
</pre>
</div>
</li>

<li><a id="orgf8e5187"></a>./double<sub>free.c</sub><br />
<div class="outline-text-5" id="text-1-6-8-5">
<p>
<a href="./double_free.c">./double_free.c</a>
</p>

<p>
Sanitize ./double<sub>free.c</sub> with address!
</p>
<div class="org-src-container">
<pre class="src src-sh">gcc -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -fsanitize=address -o double_free ./double_free.c
<span style="color: #483d8b;">echo</span> 33 | ./double_free 2&gt;&amp;1 || <span style="color: #483d8b;">echo</span> it crashed
</pre>
</div>

<pre class="example">
=================================================================
==16805==ERROR: AddressSanitizer: attempting double-free on 0x60d000000040 in thread T0:
    #0 0x7fd9b789b7a8 in __interceptor_free (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xde7a8)
    #1 0x5635b583cffa in main double_free.c:27
    #2 0x7fd9b73edb96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)
    #3 0x5635b583cca9 in _start (/home/hindle1/projects/CMPUT201W20/2020-01/CMPUT201W20B2-public/week10/double_free+0xca9)

0x60d000000040 is located 0 bytes inside of 132-byte region [0x60d000000040,0x60d0000000c4)
freed by thread T0 here:
    #0 0x7fd9b789b7a8 in __interceptor_free (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xde7a8)
    #1 0x5635b583cfeb in main double_free.c:26
    #2 0x7fd9b73edb96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)

previously allocated by thread T0 here:
    #0 0x7fd9b789bb40 in __interceptor_malloc (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xdeb40)
    #1 0x5635b583ce7d in main double_free.c:21
    #2 0x7fd9b73edb96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)

SUMMARY: AddressSanitizer: double-free (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xde7a8) in __interceptor_free
==16805==ABORTING
it crashed
</pre>

<p>
And now with undefined!
</p>
<div class="org-src-container">
<pre class="src src-sh">gcc -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -fsanitize=undefined -o double_free ./double_free.c
<span style="color: #483d8b;">echo</span> 33 | ./double_free 2&gt;&amp;1 || <span style="color: #483d8b;">echo</span> it crashed
</pre>
</div>

<pre class="example">
How big?
0
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre>
</div>
</li>

<li><a id="org2c6c857"></a>./huge<sub>array.c</sub><br />
<div class="outline-text-5" id="text-1-6-8-6">
<p>
<a href="./huge_array.c">./huge_array.c</a>
</p>

<p>
Sanitize ./huge<sub>array.c</sub> with address!
</p>
<div class="org-src-container">
<pre class="src src-sh">gcc -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -fsanitize=address -o huge_array ./huge_array.c
<span style="color: #483d8b;">echo</span> 33 | ./huge_array 2&gt;&amp;1 || <span style="color: #483d8b;">echo</span> it crashed
</pre>
</div>

<pre class="example">
0
</pre>


<p>
And now with undefined!
</p>
<div class="org-src-container">
<pre class="src src-sh">gcc -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -fsanitize=undefined -o huge_array ./huge_array.c
<span style="color: #483d8b;">echo</span> 33 | ./huge_array 2&gt;&amp;1 || <span style="color: #483d8b;">echo</span> it crashed
</pre>
</div>

<pre class="example">
0
</pre>
</div>
</li>


<li><a id="org897ed8c"></a>./malloc<sub>oob.c</sub><br />
<div class="outline-text-5" id="text-1-6-8-7">
<p>
<a href="./malloc_oob.c">./malloc_oob.c</a>
</p>

<p>
Sanitize ./malloc<sub>oob.c</sub> with address!
</p>
<div class="org-src-container">
<pre class="src src-sh">gcc -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -fsanitize=address -o malloc_oob ./malloc_oob.c
<span style="color: #483d8b;">echo</span> 33 | ./malloc_oob 2&gt;&amp;1 || <span style="color: #483d8b;">echo</span> it crashed
</pre>
</div>

<pre class="example">
=================================================================
==16842==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x60d0000001d0 at pc 0x55b070b34fa2 bp 0x7fff96f69330 sp 0x7fff96f69320
READ of size 4 at 0x60d0000001d0 thread T0
    #0 0x55b070b34fa1 in main malloc_oob.c:26
    #1 0x7f45f2034b96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)
    #2 0x55b070b34ca9 in _start (/home/hindle1/projects/CMPUT201W20/2020-01/CMPUT201W20B2-public/week10/malloc_oob+0xca9)

Address 0x60d0000001d0 is a wild pointer.
SUMMARY: AddressSanitizer: heap-buffer-overflow malloc_oob.c:26 in main
Shadow bytes around the buggy address:
  0x0c1a7fff7fe0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c1a7fff7ff0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c1a7fff8000: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00
  0x0c1a7fff8010: 00 00 00 00 00 00 00 00 04 fa fa fa fa fa fa fa
  0x0c1a7fff8020: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
=&gt;0x0c1a7fff8030: fa fa fa fa fa fa fa fa fa fa[fa]fa fa fa fa fa
  0x0c1a7fff8040: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c1a7fff8050: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c1a7fff8060: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c1a7fff8070: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c1a7fff8080: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07 
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
==16842==ABORTING
it crashed
</pre>

<p>
And now with undefined!
</p>
<div class="org-src-container">
<pre class="src src-sh">gcc -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -fsanitize=undefined -o malloc_oob ./malloc_oob.c
<span style="color: #483d8b;">echo</span> 33 | ./malloc_oob 2&gt;&amp;1 || <span style="color: #483d8b;">echo</span> it crashed
</pre>
</div>

<pre class="example">
How big?
0
</pre>


<div class="org-src-container">
<pre class="src src-sh">gcc -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -o malloc_oob ./malloc_oob.c 2&gt;&amp;1
<span style="color: #483d8b;">echo</span> 33 | ./malloc_oob 2&gt;&amp;1 || <span style="color: #483d8b;">echo</span> it crashed
</pre>
</div>

<pre class="example">
How big?
0
</pre>
</div>
</li>


<li><a id="org3dba30d"></a>./malloc<sub>uninit.c</sub><br />
<div class="outline-text-5" id="text-1-6-8-8">
<p>
<a href="./malloc_uninit.c">./malloc_uninit.c</a>
</p>

<p>
Sanitize ./malloc<sub>uninit.c</sub> with address!
</p>
<div class="org-src-container">
<pre class="src src-sh">gcc -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -fsanitize=address -o malloc_uninit ./malloc_uninit.c
<span style="color: #483d8b;">echo</span> 33 | ./malloc_uninit 2&gt;&amp;1 || <span style="color: #483d8b;">echo</span> it crashed
</pre>
</div>

<pre class="example">

=================================================================
==16869==ERROR: LeakSanitizer: detected memory leaks

Direct leak of 132 byte(s) in 1 object(s) allocated from:
    #0 0x7fb2c579bb40 in __interceptor_malloc (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xdeb40)
    #1 0x55cfc8972ddd in main malloc_uninit.c:23
    #2 0x7fb2c52edb96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)

SUMMARY: AddressSanitizer: 132 byte(s) leaked in 1 allocation(s).
it crashed
</pre>

<p>
And now with undefined!
</p>
<div class="org-src-container">
<pre class="src src-sh">gcc -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -fsanitize=undefined -o malloc_uninit ./malloc_uninit.c
<span style="color: #483d8b;">echo</span> 33 | ./malloc_uninit 2&gt;&amp;1 || <span style="color: #483d8b;">echo</span> it crashed
</pre>
</div>

<pre class="example">
How big?
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
</pre>
</div>
</li>

<li><a id="org06fb2f0"></a>./segv.c<br />
<div class="outline-text-5" id="text-1-6-8-9">
<p>
<a href="./segv.c">./segv.c</a>
</p>

<p>
Sanitize ./segv.c with address!
</p>
<div class="org-src-container">
<pre class="src src-sh">gcc -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -fsanitize=address -o segv ./segv.c
<span style="color: #483d8b;">echo</span> 33 | ./segv 2&gt;&amp;1 || <span style="color: #483d8b;">echo</span> it crashed
</pre>
</div>

<pre class="example">
ASAN:DEADLYSIGNAL
=================================================================
==16888==ERROR: AddressSanitizer: SEGV on unknown address 0x60d0003d0940 (pc 0x562a635bdfa2 bp 0x7ffe9b7eb980 sp 0x7ffe9b7eb8c0 T0)
==16888==The signal is caused by a READ memory access.
    #0 0x562a635bdfa1 in main segv.c:26
    #1 0x7f131db6ab96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)
    #2 0x562a635bdca9 in _start (/home/hindle1/projects/CMPUT201W20/2020-01/CMPUT201W20B2-public/week10/segv+0xca9)

AddressSanitizer can not provide additional info.
SUMMARY: AddressSanitizer: SEGV segv.c:26 in main
==16888==ABORTING
it crashed
</pre>

<p>
And now with undefined!
</p>
<div class="org-src-container">
<pre class="src src-sh">gcc -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -fsanitize=undefined -o segv ./segv.c
<span style="color: #483d8b;">echo</span> 33 | ./segv 2&gt;&amp;1 || <span style="color: #483d8b;">echo</span> it crashed
</pre>
</div>

<pre class="example">
it crashed
</pre>
</div>
</li>

<li><a id="orge078e36"></a>./simple<sub>uninit.c</sub><br />
<div class="outline-text-5" id="text-1-6-8-10">
<p>
<a href="./simple_uninit.c">./simple_uninit.c</a>
</p>

<p>
Sanitize ./simple<sub>uninit.c</sub> with address!
</p>
<div class="org-src-container">
<pre class="src src-sh">gcc -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -fsanitize=address -o simple_uninit ./simple_uninit.c
<span style="color: #483d8b;">echo</span> 33 | ./simple_uninit 2&gt;&amp;1 || <span style="color: #483d8b;">echo</span> it crashed
</pre>
</div>

<pre class="example">
Enter an int:
33
</pre>


<p>
And now with undefined!
</p>
<div class="org-src-container">
<pre class="src src-sh">gcc -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -fsanitize=undefined -o simple_uninit ./simple_uninit.c
<span style="color: #483d8b;">echo</span> 33 | ./simple_uninit 2&gt;&amp;1 || <span style="color: #483d8b;">echo</span> it crashed
</pre>
</div>

<pre class="example">
Enter an int:
33
</pre>
</div>
</li>

<li><a id="org3d9ce72"></a>./use<sub>after</sub><sub>free.c</sub><br />
<div class="outline-text-5" id="text-1-6-8-11">
<p>
<a href="./use_after_free.c">./use_after_free.c</a>
</p>

<p>
Sanitize ./use<sub>after</sub><sub>free.c</sub> with address!
</p>
<div class="org-src-container">
<pre class="src src-sh">gcc -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -fsanitize=address -o use_after_free ./use_after_free.c
<span style="color: #483d8b;">echo</span> 33 | ./use_after_free 2&gt;&amp;1 || <span style="color: #483d8b;">echo</span> it crashed
</pre>
</div>

<pre class="example">
=================================================================
==16935==ERROR: AddressSanitizer: heap-use-after-free on address 0x60d000000040 at pc 0x5573276330b8 bp 0x7fff96afd3a0 sp 0x7fff96afd390
READ of size 4 at 0x60d000000040 thread T0
    #0 0x5573276330b7 in main use_after_free.c:30
    #1 0x7f2f9d47bb96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)
    #2 0x557327632ca9 in _start (/home/hindle1/projects/CMPUT201W20/2020-01/CMPUT201W20B2-public/week10/use_after_free+0xca9)

0x60d000000040 is located 0 bytes inside of 132-byte region [0x60d000000040,0x60d0000000c4)
freed by thread T0 here:
    #0 0x7f2f9d9297a8 in __interceptor_free (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xde7a8)
    #1 0x55732763303c in main use_after_free.c:28
    #2 0x7f2f9d47bb96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)

previously allocated by thread T0 here:
    #0 0x7f2f9d929b40 in __interceptor_malloc (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xdeb40)
    #1 0x557327632e7e in main use_after_free.c:21
    #2 0x7f2f9d47bb96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)

SUMMARY: AddressSanitizer: heap-use-after-free use_after_free.c:30 in main
Shadow bytes around the buggy address:
  0x0c1a7fff7fb0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c1a7fff7fc0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c1a7fff7fd0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c1a7fff7fe0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c1a7fff7ff0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
=&gt;0x0c1a7fff8000: fa fa fa fa fa fa fa fa[fd]fd fd fd fd fd fd fd
  0x0c1a7fff8010: fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa
  0x0c1a7fff8020: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c1a7fff8030: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c1a7fff8040: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c1a7fff8050: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07 
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
==16935==ABORTING
it crashed
</pre>

<p>
And now with undefined!
</p>
<div class="org-src-container">
<pre class="src src-sh">gcc -std=c99 -pedantic -Wall -Wextra -ftrapv -ggdb3 -fsanitize=undefined -o use_after_free ./use_after_free.c
<span style="color: #483d8b;">echo</span> 33 | ./use_after_free 2&gt;&amp;1 || <span style="color: #483d8b;">echo</span> it crashed
</pre>
</div>

<pre class="example">
How big?
array[0] = 0
array[1] = 1
array[2] = 2
array[3] = 3
array[4] = 4
array[5] = 5
array[6] = 6
array[7] = 7
array[8] = 8
array[9] = 9
array[10] = 10
array[11] = 11
array[12] = 12
array[13] = 13
array[14] = 14
array[15] = 15
array[16] = 16
array[17] = 17
array[18] = 18
array[19] = 19
array[20] = 20
array[21] = 21
array[22] = 22
array[23] = 23
array[24] = 24
array[25] = 25
array[26] = 26
array[27] = 27
array[28] = 28
array[29] = 29
array[30] = 30
array[31] = 31
array[32] = 32
array[0] = 0
array[1] = 0
array[2] = 2
array[3] = 3
array[4] = 4
array[5] = 5
array[6] = 6
array[7] = 7
array[8] = 8
array[9] = 9
array[10] = 10
array[11] = 11
array[12] = 12
array[13] = 13
array[14] = 14
array[15] = 15
array[16] = 16
array[17] = 17
array[18] = 18
array[19] = 19
array[20] = 20
array[21] = 21
array[22] = 22
array[23] = 23
array[24] = 24
array[25] = 25
array[26] = 26
array[27] = 27
array[28] = 28
array[29] = 29
array[30] = 30
array[31] = 31
array[32] = 32
</pre>
</div>


<ol class="org-ol">
<li><a id="org83dc5a9"></a>Generator (ignore)<br />
<div class="outline-text-6" id="text-1-6-8-11-1">
<p>
This is just code for me to generate part of the slides
</p>
</div>
</li>
</ol>
</li>
</ol>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Abram Hindle</p>
<p class="date">Created: 2020-03-19 Thu 11:31</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
